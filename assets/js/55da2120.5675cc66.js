"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[5007],{3905:function(a,e,m){m.r(e),m.d(e,{MDXContext:function(){return i},MDXProvider:function(){return o},mdx:function(){return h},useMDXComponents:function(){return N},withMDXComponents:function(){return d}});var s=m(67294);function n(a,e,m){return e in a?Object.defineProperty(a,e,{value:m,enumerable:!0,configurable:!0,writable:!0}):a[e]=m,a}function t(){return t=Object.assign||function(a){for(var e=1;e<arguments.length;e++){var m=arguments[e];for(var s in m)Object.prototype.hasOwnProperty.call(m,s)&&(a[s]=m[s])}return a},t.apply(this,arguments)}function p(a,e){var m=Object.keys(a);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(a);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable}))),m.push.apply(m,s)}return m}function r(a){for(var e=1;e<arguments.length;e++){var m=null!=arguments[e]?arguments[e]:{};e%2?p(Object(m),!0).forEach((function(e){n(a,e,m[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(m)):p(Object(m)).forEach((function(e){Object.defineProperty(a,e,Object.getOwnPropertyDescriptor(m,e))}))}return a}function l(a,e){if(null==a)return{};var m,s,n=function(a,e){if(null==a)return{};var m,s,n={},t=Object.keys(a);for(s=0;s<t.length;s++)m=t[s],e.indexOf(m)>=0||(n[m]=a[m]);return n}(a,e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(a);for(s=0;s<t.length;s++)m=t[s],e.indexOf(m)>=0||Object.prototype.propertyIsEnumerable.call(a,m)&&(n[m]=a[m])}return n}var i=s.createContext({}),d=function(a){return function(e){var m=N(e.components);return s.createElement(a,t({},e,{components:m}))}},N=function(a){var e=s.useContext(i),m=e;return a&&(m="function"==typeof a?a(e):r(r({},e),a)),m},o=function(a){var e=N(a.components);return s.createElement(i.Provider,{value:e},a.children)},x={inlineCode:"code",wrapper:function(a){var e=a.children;return s.createElement(s.Fragment,{},e)}},c=s.forwardRef((function(a,e){var m=a.components,n=a.mdxType,t=a.originalType,p=a.parentName,i=l(a,["components","mdxType","originalType","parentName"]),d=N(m),o=n,c=d["".concat(p,".").concat(o)]||d[o]||x[o]||t;return m?s.createElement(c,r(r({ref:e},i),{},{components:m})):s.createElement(c,r({ref:e},i))}));function h(a,e){var m=arguments,n=e&&e.mdxType;if("string"==typeof a||n){var t=m.length,p=new Array(t);p[0]=c;var r={};for(var l in e)hasOwnProperty.call(e,l)&&(r[l]=e[l]);r.originalType=a,r.mdxType="string"==typeof a?a:n,p[1]=r;for(var i=2;i<t;i++)p[i]=m[i];return s.createElement.apply(null,p)}return s.createElement.apply(null,m)}c.displayName="MDXCreateElement"},36167:function(a,e,m){m.r(e),m.d(e,{assets:function(){return d},contentTitle:function(){return l},default:function(){return x},frontMatter:function(){return r},metadata:function(){return i},toc:function(){return N}});var s=m(83117),n=m(80102),t=(m(67294),m(3905)),p=["components"],r={id:"hamiltonian_monte_carlo",title:"Hamiltonian Monte Carlo",sidebar_label:"Hamiltonian Monte Carlo",slug:"/hamiltonian_monte_carlo"},l=void 0,i={unversionedId:"framework_topics/mcmc_inference/hamiltonian_monte_carlo",id:"framework_topics/mcmc_inference/hamiltonian_monte_carlo",title:"Hamiltonian Monte Carlo",description:"Hamiltonian Monte Carlo (HMC) is a sampling algorithm for differentiable random variables which uses Hamiltonian dynamics. By randomly drawing a momentum for the kinetic energy and treating the true posterior as the potential energy, HMC is able to simulate trajectories which explore the space. Intuitively, this can be viewed as starting with a marble at a point inside a bowl, flicking the marble in a random direction, and then following the marble as it rolls around. The position of the marble represents the sample, the flick represents the momentum, and the shape of the bowl in combination with the force of gravity represents our true posterior.",source:"@site/../docs/framework_topics/mcmc_inference/hamiltonian_monte_carlo.md",sourceDirName:"framework_topics/mcmc_inference",slug:"/hamiltonian_monte_carlo",permalink:"/docs/hamiltonian_monte_carlo",draft:!1,editUrl:"https://github.com/facebookresearch/beanmachine/edit/main/website/../docs/framework_topics/mcmc_inference/hamiltonian_monte_carlo.md",tags:[],version:"current",frontMatter:{id:"hamiltonian_monte_carlo",title:"Hamiltonian Monte Carlo",sidebar_label:"Hamiltonian Monte Carlo",slug:"/hamiltonian_monte_carlo"},sidebar:"someSidebar",previous:{title:"Single-Site Uniform MH",permalink:"/docs/uniform_metropolis_hastings"},next:{title:"No-U-Turn Sampler",permalink:"/docs/no_u_turn_sampler"}},d={},N=[{value:"Hamiltonian dynamics",id:"hamiltonian-dynamics",level:2},{value:"Approximating Hamiltonian dynamics",id:"approximating-hamiltonian-dynamics",level:2},{value:"Adaptive Hamiltonian Monte Carlo",id:"adaptive-hamiltonian-monte-carlo",level:2},{value:"Tuning the path length",id:"tuning-the-path-length",level:2},{value:"Usage",id:"usage",level:2}],o={toc:N};function x(a){var e=a.components,m=(0,n.Z)(a,p);return(0,t.mdx)("wrapper",(0,s.Z)({},o,m,{components:e,mdxType:"MDXLayout"}),(0,t.mdx)("p",null,"Hamiltonian Monte Carlo (HMC) is a sampling algorithm for differentiable random variables which uses Hamiltonian dynamics. By randomly drawing a momentum for the kinetic energy and treating the true posterior as the potential energy, HMC is able to simulate trajectories which explore the space. Intuitively, this can be viewed as starting with a marble at a point inside a bowl, flicking the marble in a random direction, and then following the marble as it rolls around. The position of the marble represents the sample, the flick represents the momentum, and the shape of the bowl in combination with the force of gravity represents our true posterior."),(0,t.mdx)("h2",{id:"hamiltonian-dynamics"},"Hamiltonian dynamics"),(0,t.mdx)("p",null,'HMC applies Hamiltonian dynamics to explore the state space. This means that we think of the posterior surface as having some potential energy, proportional to the posterior\'s negative log likelihood at some particular set of parameter assignments. We use that potential energy, along with kinetic energy injected in the form of a random momentum "kick", to traverse the surface according to the laws of physics.'),(0,t.mdx)("p",null,"Below, we'll use ",(0,t.mdx)("span",{parentName:"p",className:"math math-inline"},(0,t.mdx)("span",{parentName:"span",className:"katex"},(0,t.mdx)("span",{parentName:"span",className:"katex-mathml"},(0,t.mdx)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,t.mdx)("semantics",{parentName:"math"},(0,t.mdx)("mrow",{parentName:"semantics"},(0,t.mdx)("mi",{parentName:"mrow"},"q")),(0,t.mdx)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"q")))),(0,t.mdx)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,t.mdx)("span",{parentName:"span",className:"base"},(0,t.mdx)("span",{parentName:"span",className:"strut",style:{height:"0.625em",verticalAlign:"-0.19444em"}}),(0,t.mdx)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.03588em"}},"q")))))," to represent the current set of parameter assignments, and ",(0,t.mdx)("span",{parentName:"p",className:"math math-inline"},(0,t.mdx)("span",{parentName:"span",className:"katex"},(0,t.mdx)("span",{parentName:"span",className:"katex-mathml"},(0,t.mdx)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,t.mdx)("semantics",{parentName:"math"},(0,t.mdx)("mrow",{parentName:"semantics"},(0,t.mdx)("mi",{parentName:"mrow"},"p")),(0,t.mdx)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"p")))),(0,t.mdx)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,t.mdx)("span",{parentName:"span",className:"base"},(0,t.mdx)("span",{parentName:"span",className:"strut",style:{height:"0.625em",verticalAlign:"-0.19444em"}}),(0,t.mdx)("span",{parentName:"span",className:"mord mathnormal"},"p")))))," to represent a random momentum factor injected into the system by the inference method. The Hamiltonian physics alluded to above can be written as"),(0,t.mdx)("div",{className:"math math-display"},(0,t.mdx)("span",{parentName:"div",className:"katex-display"},(0,t.mdx)("span",{parentName:"span",className:"katex"},(0,t.mdx)("span",{parentName:"span",className:"katex-mathml"},(0,t.mdx)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},(0,t.mdx)("semantics",{parentName:"math"},(0,t.mdx)("mrow",{parentName:"semantics"},(0,t.mdx)("mi",{parentName:"mrow"},"H"),(0,t.mdx)("mo",{parentName:"mrow",stretchy:"false"},"("),(0,t.mdx)("mi",{parentName:"mrow"},"q"),(0,t.mdx)("mo",{parentName:"mrow",separator:"true"},","),(0,t.mdx)("mi",{parentName:"mrow"},"p"),(0,t.mdx)("mo",{parentName:"mrow",stretchy:"false"},")"),(0,t.mdx)("mo",{parentName:"mrow"},"="),(0,t.mdx)("mi",{parentName:"mrow"},"U"),(0,t.mdx)("mo",{parentName:"mrow",stretchy:"false"},"("),(0,t.mdx)("mi",{parentName:"mrow"},"q"),(0,t.mdx)("mo",{parentName:"mrow",stretchy:"false"},")"),(0,t.mdx)("mo",{parentName:"mrow"},"+"),(0,t.mdx)("mi",{parentName:"mrow"},"K"),(0,t.mdx)("mo",{parentName:"mrow",stretchy:"false"},"("),(0,t.mdx)("mi",{parentName:"mrow"},"p"),(0,t.mdx)("mo",{parentName:"mrow",stretchy:"false"},")"),(0,t.mdx)("mo",{parentName:"mrow",separator:"true"},",")),(0,t.mdx)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"H(q, p) = U(q) + K(p),")))),(0,t.mdx)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,t.mdx)("span",{parentName:"span",className:"base"},(0,t.mdx)("span",{parentName:"span",className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,t.mdx)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.08125em"}},"H"),(0,t.mdx)("span",{parentName:"span",className:"mopen"},"("),(0,t.mdx)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.03588em"}},"q"),(0,t.mdx)("span",{parentName:"span",className:"mpunct"},","),(0,t.mdx)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.16666666666666666em"}}),(0,t.mdx)("span",{parentName:"span",className:"mord mathnormal"},"p"),(0,t.mdx)("span",{parentName:"span",className:"mclose"},")"),(0,t.mdx)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2777777777777778em"}}),(0,t.mdx)("span",{parentName:"span",className:"mrel"},"="),(0,t.mdx)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2777777777777778em"}})),(0,t.mdx)("span",{parentName:"span",className:"base"},(0,t.mdx)("span",{parentName:"span",className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,t.mdx)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.10903em"}},"U"),(0,t.mdx)("span",{parentName:"span",className:"mopen"},"("),(0,t.mdx)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.03588em"}},"q"),(0,t.mdx)("span",{parentName:"span",className:"mclose"},")"),(0,t.mdx)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2222222222222222em"}}),(0,t.mdx)("span",{parentName:"span",className:"mbin"},"+"),(0,t.mdx)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2222222222222222em"}})),(0,t.mdx)("span",{parentName:"span",className:"base"},(0,t.mdx)("span",{parentName:"span",className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,t.mdx)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.07153em"}},"K"),(0,t.mdx)("span",{parentName:"span",className:"mopen"},"("),(0,t.mdx)("span",{parentName:"span",className:"mord mathnormal"},"p"),(0,t.mdx)("span",{parentName:"span",className:"mclose"},")"),(0,t.mdx)("span",{parentName:"span",className:"mpunct"},",")))))),(0,t.mdx)("p",null,"where ",(0,t.mdx)("span",{parentName:"p",className:"math math-inline"},(0,t.mdx)("span",{parentName:"span",className:"katex"},(0,t.mdx)("span",{parentName:"span",className:"katex-mathml"},(0,t.mdx)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,t.mdx)("semantics",{parentName:"math"},(0,t.mdx)("mrow",{parentName:"semantics"},(0,t.mdx)("mi",{parentName:"mrow"},"U")),(0,t.mdx)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"U")))),(0,t.mdx)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,t.mdx)("span",{parentName:"span",className:"base"},(0,t.mdx)("span",{parentName:"span",className:"strut",style:{height:"0.68333em",verticalAlign:"0em"}}),(0,t.mdx)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.10903em"}},"U")))))," and ",(0,t.mdx)("span",{parentName:"p",className:"math math-inline"},(0,t.mdx)("span",{parentName:"span",className:"katex"},(0,t.mdx)("span",{parentName:"span",className:"katex-mathml"},(0,t.mdx)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,t.mdx)("semantics",{parentName:"math"},(0,t.mdx)("mrow",{parentName:"semantics"},(0,t.mdx)("mi",{parentName:"mrow"},"K")),(0,t.mdx)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"K")))),(0,t.mdx)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,t.mdx)("span",{parentName:"span",className:"base"},(0,t.mdx)("span",{parentName:"span",className:"strut",style:{height:"0.68333em",verticalAlign:"0em"}}),(0,t.mdx)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.07153em"}},"K")))))," represent the potential and kinetic energy respectively."),(0,t.mdx)("p",null,"The potential energy represents the shape of the posterior distribution, and is defined by"),(0,t.mdx)("div",{className:"math math-display"},(0,t.mdx)("span",{parentName:"div",className:"katex-display"},(0,t.mdx)("span",{parentName:"span",className:"katex"},(0,t.mdx)("span",{parentName:"span",className:"katex-mathml"},(0,t.mdx)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},(0,t.mdx)("semantics",{parentName:"math"},(0,t.mdx)("mrow",{parentName:"semantics"},(0,t.mdx)("mi",{parentName:"mrow"},"U"),(0,t.mdx)("mo",{parentName:"mrow",stretchy:"false"},"("),(0,t.mdx)("mi",{parentName:"mrow"},"q"),(0,t.mdx)("mo",{parentName:"mrow",stretchy:"false"},")"),(0,t.mdx)("mo",{parentName:"mrow"},"="),(0,t.mdx)("mo",{parentName:"mrow"},"\u2212"),(0,t.mdx)("mi",{parentName:"mrow"},"log"),(0,t.mdx)("mo",{parentName:"mrow"},"\u2061"),(0,t.mdx)("mo",{parentName:"mrow",stretchy:"false"},"["),(0,t.mdx)("mi",{parentName:"mrow"},"\u03c0"),(0,t.mdx)("mo",{parentName:"mrow",stretchy:"false"},"("),(0,t.mdx)("mi",{parentName:"mrow"},"q"),(0,t.mdx)("mo",{parentName:"mrow",stretchy:"false"},")"),(0,t.mdx)("mi",{parentName:"mrow"},"L"),(0,t.mdx)("mo",{parentName:"mrow",stretchy:"false"},"("),(0,t.mdx)("mi",{parentName:"mrow"},"q"),(0,t.mdx)("mo",{parentName:"mrow"},"\u2223"),(0,t.mdx)("mi",{parentName:"mrow"},"D"),(0,t.mdx)("mo",{parentName:"mrow",stretchy:"false"},")"),(0,t.mdx)("mo",{parentName:"mrow",stretchy:"false"},"]"),(0,t.mdx)("mi",{parentName:"mrow",mathvariant:"normal"},".")),(0,t.mdx)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"U(q) = -\\log[\\pi(q)L(q\\mid D)].")))),(0,t.mdx)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,t.mdx)("span",{parentName:"span",className:"base"},(0,t.mdx)("span",{parentName:"span",className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,t.mdx)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.10903em"}},"U"),(0,t.mdx)("span",{parentName:"span",className:"mopen"},"("),(0,t.mdx)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.03588em"}},"q"),(0,t.mdx)("span",{parentName:"span",className:"mclose"},")"),(0,t.mdx)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2777777777777778em"}}),(0,t.mdx)("span",{parentName:"span",className:"mrel"},"="),(0,t.mdx)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2777777777777778em"}})),(0,t.mdx)("span",{parentName:"span",className:"base"},(0,t.mdx)("span",{parentName:"span",className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,t.mdx)("span",{parentName:"span",className:"mord"},"\u2212"),(0,t.mdx)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.16666666666666666em"}}),(0,t.mdx)("span",{parentName:"span",className:"mop"},"lo",(0,t.mdx)("span",{parentName:"span",style:{marginRight:"0.01389em"}},"g")),(0,t.mdx)("span",{parentName:"span",className:"mopen"},"["),(0,t.mdx)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.03588em"}},"\u03c0"),(0,t.mdx)("span",{parentName:"span",className:"mopen"},"("),(0,t.mdx)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.03588em"}},"q"),(0,t.mdx)("span",{parentName:"span",className:"mclose"},")"),(0,t.mdx)("span",{parentName:"span",className:"mord mathnormal"},"L"),(0,t.mdx)("span",{parentName:"span",className:"mopen"},"("),(0,t.mdx)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.03588em"}},"q"),(0,t.mdx)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2777777777777778em"}}),(0,t.mdx)("span",{parentName:"span",className:"mrel"},"\u2223"),(0,t.mdx)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2777777777777778em"}})),(0,t.mdx)("span",{parentName:"span",className:"base"},(0,t.mdx)("span",{parentName:"span",className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,t.mdx)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.02778em"}},"D"),(0,t.mdx)("span",{parentName:"span",className:"mclose"},")"),(0,t.mdx)("span",{parentName:"span",className:"mclose"},"]"),(0,t.mdx)("span",{parentName:"span",className:"mord"},".")))))),(0,t.mdx)("p",null,"Here, ",(0,t.mdx)("span",{parentName:"p",className:"math math-inline"},(0,t.mdx)("span",{parentName:"span",className:"katex"},(0,t.mdx)("span",{parentName:"span",className:"katex-mathml"},(0,t.mdx)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,t.mdx)("semantics",{parentName:"math"},(0,t.mdx)("mrow",{parentName:"semantics"},(0,t.mdx)("mi",{parentName:"mrow"},"L"),(0,t.mdx)("mo",{parentName:"mrow",stretchy:"false"},"("),(0,t.mdx)("mi",{parentName:"mrow"},"q"),(0,t.mdx)("mo",{parentName:"mrow"},"\u2223"),(0,t.mdx)("mi",{parentName:"mrow"},"D"),(0,t.mdx)("mo",{parentName:"mrow",stretchy:"false"},")")),(0,t.mdx)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"L(q\\mid D)")))),(0,t.mdx)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,t.mdx)("span",{parentName:"span",className:"base"},(0,t.mdx)("span",{parentName:"span",className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,t.mdx)("span",{parentName:"span",className:"mord mathnormal"},"L"),(0,t.mdx)("span",{parentName:"span",className:"mopen"},"("),(0,t.mdx)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.03588em"}},"q"),(0,t.mdx)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2777777777777778em"}}),(0,t.mdx)("span",{parentName:"span",className:"mrel"},"\u2223"),(0,t.mdx)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2777777777777778em"}})),(0,t.mdx)("span",{parentName:"span",className:"base"},(0,t.mdx)("span",{parentName:"span",className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,t.mdx)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.02778em"}},"D"),(0,t.mdx)("span",{parentName:"span",className:"mclose"},")")))))," is the likelihood of the model evaluated at the parameter assignments ",(0,t.mdx)("span",{parentName:"p",className:"math math-inline"},(0,t.mdx)("span",{parentName:"span",className:"katex"},(0,t.mdx)("span",{parentName:"span",className:"katex-mathml"},(0,t.mdx)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,t.mdx)("semantics",{parentName:"math"},(0,t.mdx)("mrow",{parentName:"semantics"},(0,t.mdx)("mi",{parentName:"mrow"},"q")),(0,t.mdx)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"q")))),(0,t.mdx)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,t.mdx)("span",{parentName:"span",className:"base"},(0,t.mdx)("span",{parentName:"span",className:"strut",style:{height:"0.625em",verticalAlign:"-0.19444em"}}),(0,t.mdx)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.03588em"}},"q"))))),", conditioned on the observed dataset ",(0,t.mdx)("span",{parentName:"p",className:"math math-inline"},(0,t.mdx)("span",{parentName:"span",className:"katex"},(0,t.mdx)("span",{parentName:"span",className:"katex-mathml"},(0,t.mdx)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,t.mdx)("semantics",{parentName:"math"},(0,t.mdx)("mrow",{parentName:"semantics"},(0,t.mdx)("mi",{parentName:"mrow"},"D")),(0,t.mdx)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"D")))),(0,t.mdx)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,t.mdx)("span",{parentName:"span",className:"base"},(0,t.mdx)("span",{parentName:"span",className:"strut",style:{height:"0.68333em",verticalAlign:"0em"}}),(0,t.mdx)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.02778em"}},"D"))))),"."),(0,t.mdx)("p",null,"The potential energy can be evaluated directly in Bean Machine as a function of the model's posterior probability at the current parameter values."),(0,t.mdx)("p",null,"The kinetic energy is defined using the momentum variable ",(0,t.mdx)("span",{parentName:"p",className:"math math-inline"},(0,t.mdx)("span",{parentName:"span",className:"katex"},(0,t.mdx)("span",{parentName:"span",className:"katex-mathml"},(0,t.mdx)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,t.mdx)("semantics",{parentName:"math"},(0,t.mdx)("mrow",{parentName:"semantics"},(0,t.mdx)("mi",{parentName:"mrow"},"p")),(0,t.mdx)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"p")))),(0,t.mdx)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,t.mdx)("span",{parentName:"span",className:"base"},(0,t.mdx)("span",{parentName:"span",className:"strut",style:{height:"0.625em",verticalAlign:"-0.19444em"}}),(0,t.mdx)("span",{parentName:"span",className:"mord mathnormal"},"p")))))," as well as an inference-method-defined covariance matrix ",(0,t.mdx)("span",{parentName:"p",className:"math math-inline"},(0,t.mdx)("span",{parentName:"span",className:"katex"},(0,t.mdx)("span",{parentName:"span",className:"katex-mathml"},(0,t.mdx)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,t.mdx)("semantics",{parentName:"math"},(0,t.mdx)("mrow",{parentName:"semantics"},(0,t.mdx)("mi",{parentName:"mrow",mathvariant:"normal"},"\u03a3")),(0,t.mdx)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"\\Sigma")))),(0,t.mdx)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,t.mdx)("span",{parentName:"span",className:"base"},(0,t.mdx)("span",{parentName:"span",className:"strut",style:{height:"0.68333em",verticalAlign:"0em"}}),(0,t.mdx)("span",{parentName:"span",className:"mord"},"\u03a3"))))),","),(0,t.mdx)("div",{className:"math math-display"},(0,t.mdx)("span",{parentName:"div",className:"katex-display"},(0,t.mdx)("span",{parentName:"span",className:"katex"},(0,t.mdx)("span",{parentName:"span",className:"katex-mathml"},(0,t.mdx)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},(0,t.mdx)("semantics",{parentName:"math"},(0,t.mdx)("mrow",{parentName:"semantics"},(0,t.mdx)("mi",{parentName:"mrow"},"K"),(0,t.mdx)("mo",{parentName:"mrow",stretchy:"false"},"("),(0,t.mdx)("mi",{parentName:"mrow"},"p"),(0,t.mdx)("mo",{parentName:"mrow",stretchy:"false"},")"),(0,t.mdx)("mo",{parentName:"mrow"},"="),(0,t.mdx)("msup",{parentName:"mrow"},(0,t.mdx)("mi",{parentName:"msup"},"p"),(0,t.mdx)("mi",{parentName:"msup"},"T")),(0,t.mdx)("mi",{parentName:"mrow",mathvariant:"normal"},"\u03a3"),(0,t.mdx)("mi",{parentName:"mrow"},"p"),(0,t.mdx)("mi",{parentName:"mrow",mathvariant:"normal"},"/"),(0,t.mdx)("mn",{parentName:"mrow"},"2.")),(0,t.mdx)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"K(p) = p^T\\Sigma p/2.")))),(0,t.mdx)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,t.mdx)("span",{parentName:"span",className:"base"},(0,t.mdx)("span",{parentName:"span",className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,t.mdx)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.07153em"}},"K"),(0,t.mdx)("span",{parentName:"span",className:"mopen"},"("),(0,t.mdx)("span",{parentName:"span",className:"mord mathnormal"},"p"),(0,t.mdx)("span",{parentName:"span",className:"mclose"},")"),(0,t.mdx)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2777777777777778em"}}),(0,t.mdx)("span",{parentName:"span",className:"mrel"},"="),(0,t.mdx)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2777777777777778em"}})),(0,t.mdx)("span",{parentName:"span",className:"base"},(0,t.mdx)("span",{parentName:"span",className:"strut",style:{height:"1.1413309999999999em",verticalAlign:"-0.25em"}}),(0,t.mdx)("span",{parentName:"span",className:"mord"},(0,t.mdx)("span",{parentName:"span",className:"mord mathnormal"},"p"),(0,t.mdx)("span",{parentName:"span",className:"msupsub"},(0,t.mdx)("span",{parentName:"span",className:"vlist-t"},(0,t.mdx)("span",{parentName:"span",className:"vlist-r"},(0,t.mdx)("span",{parentName:"span",className:"vlist",style:{height:"0.8913309999999999em"}},(0,t.mdx)("span",{parentName:"span",style:{top:"-3.113em",marginRight:"0.05em"}},(0,t.mdx)("span",{parentName:"span",className:"pstrut",style:{height:"2.7em"}}),(0,t.mdx)("span",{parentName:"span",className:"sizing reset-size6 size3 mtight"},(0,t.mdx)("span",{parentName:"span",className:"mord mathnormal mtight",style:{marginRight:"0.13889em"}},"T")))))))),(0,t.mdx)("span",{parentName:"span",className:"mord"},"\u03a3"),(0,t.mdx)("span",{parentName:"span",className:"mord mathnormal"},"p"),(0,t.mdx)("span",{parentName:"span",className:"mord"},"/"),(0,t.mdx)("span",{parentName:"span",className:"mord"},"2"),(0,t.mdx)("span",{parentName:"span",className:"mord"},".")))))),(0,t.mdx)("p",null,"The values for ",(0,t.mdx)("span",{parentName:"p",className:"math math-inline"},(0,t.mdx)("span",{parentName:"span",className:"katex"},(0,t.mdx)("span",{parentName:"span",className:"katex-mathml"},(0,t.mdx)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,t.mdx)("semantics",{parentName:"math"},(0,t.mdx)("mrow",{parentName:"semantics"},(0,t.mdx)("mi",{parentName:"mrow"},"p")),(0,t.mdx)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"p")))),(0,t.mdx)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,t.mdx)("span",{parentName:"span",className:"base"},(0,t.mdx)("span",{parentName:"span",className:"strut",style:{height:"0.625em",verticalAlign:"-0.19444em"}}),(0,t.mdx)("span",{parentName:"span",className:"mord mathnormal"},"p")))))," and ",(0,t.mdx)("span",{parentName:"p",className:"math math-inline"},(0,t.mdx)("span",{parentName:"span",className:"katex"},(0,t.mdx)("span",{parentName:"span",className:"katex-mathml"},(0,t.mdx)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,t.mdx)("semantics",{parentName:"math"},(0,t.mdx)("mrow",{parentName:"semantics"},(0,t.mdx)("mi",{parentName:"mrow",mathvariant:"normal"},"\u03a3")),(0,t.mdx)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"\\Sigma")))),(0,t.mdx)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,t.mdx)("span",{parentName:"span",className:"base"},(0,t.mdx)("span",{parentName:"span",className:"strut",style:{height:"0.68333em",verticalAlign:"0em"}}),(0,t.mdx)("span",{parentName:"span",className:"mord"},"\u03a3")))))," are provided by the framework. Bean Machine samples from a Normal distribution scaled to the appropriate posterior size for ",(0,t.mdx)("span",{parentName:"p",className:"math math-inline"},(0,t.mdx)("span",{parentName:"span",className:"katex"},(0,t.mdx)("span",{parentName:"span",className:"katex-mathml"},(0,t.mdx)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,t.mdx)("semantics",{parentName:"math"},(0,t.mdx)("mrow",{parentName:"semantics"},(0,t.mdx)("mi",{parentName:"mrow"},"p")),(0,t.mdx)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"p")))),(0,t.mdx)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,t.mdx)("span",{parentName:"span",className:"base"},(0,t.mdx)("span",{parentName:"span",className:"strut",style:{height:"0.625em",verticalAlign:"-0.19444em"}}),(0,t.mdx)("span",{parentName:"span",className:"mord mathnormal"},"p"))))),". Bean Machine can optionally estimate an appropriate constant value for ",(0,t.mdx)("span",{parentName:"p",className:"math math-inline"},(0,t.mdx)("span",{parentName:"span",className:"katex"},(0,t.mdx)("span",{parentName:"span",className:"katex-mathml"},(0,t.mdx)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,t.mdx)("semantics",{parentName:"math"},(0,t.mdx)("mrow",{parentName:"semantics"},(0,t.mdx)("mi",{parentName:"mrow",mathvariant:"normal"},"\u03a3")),(0,t.mdx)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"\\Sigma")))),(0,t.mdx)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,t.mdx)("span",{parentName:"span",className:"base"},(0,t.mdx)("span",{parentName:"span",className:"strut",style:{height:"0.68333em",verticalAlign:"0em"}}),(0,t.mdx)("span",{parentName:"span",className:"mord"},"\u03a3")))))," by measuring correlations between parameters during an adaptation phase of inference."),(0,t.mdx)("p",null,"We can then simulate the trajectory using the following forms of Hamilton's equations:"),(0,t.mdx)("div",{className:"math math-display"},(0,t.mdx)("span",{parentName:"div",className:"katex-display"},(0,t.mdx)("span",{parentName:"span",className:"katex"},(0,t.mdx)("span",{parentName:"span",className:"katex-mathml"},(0,t.mdx)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},(0,t.mdx)("semantics",{parentName:"math"},(0,t.mdx)("mtable",{parentName:"semantics",rowspacing:"0.24999999999999992em",columnalign:"right left",columnspacing:"0em"},(0,t.mdx)("mtr",{parentName:"mtable"},(0,t.mdx)("mtd",{parentName:"mtr"},(0,t.mdx)("mstyle",{parentName:"mtd",scriptlevel:"0",displaystyle:"true"},(0,t.mdx)("mfrac",{parentName:"mstyle"},(0,t.mdx)("mrow",{parentName:"mfrac"},(0,t.mdx)("mi",{parentName:"mrow"},"d"),(0,t.mdx)("msub",{parentName:"mrow"},(0,t.mdx)("mi",{parentName:"msub"},"q"),(0,t.mdx)("mi",{parentName:"msub"},"i"))),(0,t.mdx)("mrow",{parentName:"mfrac"},(0,t.mdx)("mi",{parentName:"mrow"},"d"),(0,t.mdx)("mi",{parentName:"mrow"},"t"))))),(0,t.mdx)("mtd",{parentName:"mtr"},(0,t.mdx)("mstyle",{parentName:"mtd",scriptlevel:"0",displaystyle:"true"},(0,t.mdx)("mrow",{parentName:"mstyle"},(0,t.mdx)("mrow",{parentName:"mrow"}),(0,t.mdx)("mo",{parentName:"mrow"},"="),(0,t.mdx)("mo",{parentName:"mrow",stretchy:"false"},"["),(0,t.mdx)("mi",{parentName:"mrow",mathvariant:"normal"},"\u03a3"),(0,t.mdx)("mi",{parentName:"mrow"},"p"),(0,t.mdx)("msub",{parentName:"mrow"},(0,t.mdx)("mo",{parentName:"msub",stretchy:"false"},"]"),(0,t.mdx)("mi",{parentName:"msub"},"i")))))),(0,t.mdx)("mtr",{parentName:"mtable"},(0,t.mdx)("mtd",{parentName:"mtr"},(0,t.mdx)("mstyle",{parentName:"mtd",scriptlevel:"0",displaystyle:"true"},(0,t.mdx)("mfrac",{parentName:"mstyle"},(0,t.mdx)("mrow",{parentName:"mfrac"},(0,t.mdx)("mi",{parentName:"mrow"},"d"),(0,t.mdx)("msub",{parentName:"mrow"},(0,t.mdx)("mi",{parentName:"msub"},"p"),(0,t.mdx)("mi",{parentName:"msub"},"i"))),(0,t.mdx)("mrow",{parentName:"mfrac"},(0,t.mdx)("mi",{parentName:"mrow"},"d"),(0,t.mdx)("mi",{parentName:"mrow"},"t"))))),(0,t.mdx)("mtd",{parentName:"mtr"},(0,t.mdx)("mstyle",{parentName:"mtd",scriptlevel:"0",displaystyle:"true"},(0,t.mdx)("mrow",{parentName:"mstyle"},(0,t.mdx)("mrow",{parentName:"mrow"}),(0,t.mdx)("mo",{parentName:"mrow"},"="),(0,t.mdx)("mo",{parentName:"mrow"},"\u2212"),(0,t.mdx)("mfrac",{parentName:"mrow"},(0,t.mdx)("mrow",{parentName:"mfrac"},(0,t.mdx)("mi",{parentName:"mrow",mathvariant:"normal"},"\u2202"),(0,t.mdx)("mi",{parentName:"mrow"},"U")),(0,t.mdx)("mrow",{parentName:"mfrac"},(0,t.mdx)("mi",{parentName:"mrow",mathvariant:"normal"},"\u2202"),(0,t.mdx)("msub",{parentName:"mrow"},(0,t.mdx)("mi",{parentName:"msub"},"q"),(0,t.mdx)("mi",{parentName:"msub"},"i"))))))))),(0,t.mdx)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"\\begin{aligned} \\frac{dq_i}{dt} &= [\\Sigma p]_i\\\\ \\frac{dp_i}{dt} &= -\\frac{\\partial U}{\\partial q_i} \\end{aligned}")))),(0,t.mdx)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,t.mdx)("span",{parentName:"span",className:"base"},(0,t.mdx)("span",{parentName:"span",className:"strut",style:{height:"4.909320000000001em",verticalAlign:"-2.204660000000001em"}}),(0,t.mdx)("span",{parentName:"span",className:"mord"},(0,t.mdx)("span",{parentName:"span",className:"mtable"},(0,t.mdx)("span",{parentName:"span",className:"col-align-r"},(0,t.mdx)("span",{parentName:"span",className:"vlist-t vlist-t2"},(0,t.mdx)("span",{parentName:"span",className:"vlist-r"},(0,t.mdx)("span",{parentName:"span",className:"vlist",style:{height:"2.70466em"}},(0,t.mdx)("span",{parentName:"span",style:{top:"-4.70466em"}},(0,t.mdx)("span",{parentName:"span",className:"pstrut",style:{height:"3.3714399999999998em"}}),(0,t.mdx)("span",{parentName:"span",className:"mord"},(0,t.mdx)("span",{parentName:"span",className:"mord"},(0,t.mdx)("span",{parentName:"span",className:"mopen nulldelimiter"}),(0,t.mdx)("span",{parentName:"span",className:"mfrac"},(0,t.mdx)("span",{parentName:"span",className:"vlist-t vlist-t2"},(0,t.mdx)("span",{parentName:"span",className:"vlist-r"},(0,t.mdx)("span",{parentName:"span",className:"vlist",style:{height:"1.3714399999999998em"}},(0,t.mdx)("span",{parentName:"span",style:{top:"-2.314em"}},(0,t.mdx)("span",{parentName:"span",className:"pstrut",style:{height:"3em"}}),(0,t.mdx)("span",{parentName:"span",className:"mord"},(0,t.mdx)("span",{parentName:"span",className:"mord mathnormal"},"d"),(0,t.mdx)("span",{parentName:"span",className:"mord mathnormal"},"t"))),(0,t.mdx)("span",{parentName:"span",style:{top:"-3.23em"}},(0,t.mdx)("span",{parentName:"span",className:"pstrut",style:{height:"3em"}}),(0,t.mdx)("span",{parentName:"span",className:"frac-line",style:{borderBottomWidth:"0.04em"}})),(0,t.mdx)("span",{parentName:"span",style:{top:"-3.677em"}},(0,t.mdx)("span",{parentName:"span",className:"pstrut",style:{height:"3em"}}),(0,t.mdx)("span",{parentName:"span",className:"mord"},(0,t.mdx)("span",{parentName:"span",className:"mord mathnormal"},"d"),(0,t.mdx)("span",{parentName:"span",className:"mord"},(0,t.mdx)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.03588em"}},"q"),(0,t.mdx)("span",{parentName:"span",className:"msupsub"},(0,t.mdx)("span",{parentName:"span",className:"vlist-t vlist-t2"},(0,t.mdx)("span",{parentName:"span",className:"vlist-r"},(0,t.mdx)("span",{parentName:"span",className:"vlist",style:{height:"0.31166399999999994em"}},(0,t.mdx)("span",{parentName:"span",style:{top:"-2.5500000000000003em",marginLeft:"-0.03588em",marginRight:"0.05em"}},(0,t.mdx)("span",{parentName:"span",className:"pstrut",style:{height:"2.7em"}}),(0,t.mdx)("span",{parentName:"span",className:"sizing reset-size6 size3 mtight"},(0,t.mdx)("span",{parentName:"span",className:"mord mathnormal mtight"},"i")))),(0,t.mdx)("span",{parentName:"span",className:"vlist-s"},"\u200b")),(0,t.mdx)("span",{parentName:"span",className:"vlist-r"},(0,t.mdx)("span",{parentName:"span",className:"vlist",style:{height:"0.15em"}},(0,t.mdx)("span",{parentName:"span"}))))))))),(0,t.mdx)("span",{parentName:"span",className:"vlist-s"},"\u200b")),(0,t.mdx)("span",{parentName:"span",className:"vlist-r"},(0,t.mdx)("span",{parentName:"span",className:"vlist",style:{height:"0.686em"}},(0,t.mdx)("span",{parentName:"span"}))))),(0,t.mdx)("span",{parentName:"span",className:"mclose nulldelimiter"})))),(0,t.mdx)("span",{parentName:"span",style:{top:"-2.347219999999999em"}},(0,t.mdx)("span",{parentName:"span",className:"pstrut",style:{height:"3.3714399999999998em"}}),(0,t.mdx)("span",{parentName:"span",className:"mord"},(0,t.mdx)("span",{parentName:"span",className:"mord"},(0,t.mdx)("span",{parentName:"span",className:"mopen nulldelimiter"}),(0,t.mdx)("span",{parentName:"span",className:"mfrac"},(0,t.mdx)("span",{parentName:"span",className:"vlist-t vlist-t2"},(0,t.mdx)("span",{parentName:"span",className:"vlist-r"},(0,t.mdx)("span",{parentName:"span",className:"vlist",style:{height:"1.3714399999999998em"}},(0,t.mdx)("span",{parentName:"span",style:{top:"-2.314em"}},(0,t.mdx)("span",{parentName:"span",className:"pstrut",style:{height:"3em"}}),(0,t.mdx)("span",{parentName:"span",className:"mord"},(0,t.mdx)("span",{parentName:"span",className:"mord mathnormal"},"d"),(0,t.mdx)("span",{parentName:"span",className:"mord mathnormal"},"t"))),(0,t.mdx)("span",{parentName:"span",style:{top:"-3.23em"}},(0,t.mdx)("span",{parentName:"span",className:"pstrut",style:{height:"3em"}}),(0,t.mdx)("span",{parentName:"span",className:"frac-line",style:{borderBottomWidth:"0.04em"}})),(0,t.mdx)("span",{parentName:"span",style:{top:"-3.677em"}},(0,t.mdx)("span",{parentName:"span",className:"pstrut",style:{height:"3em"}}),(0,t.mdx)("span",{parentName:"span",className:"mord"},(0,t.mdx)("span",{parentName:"span",className:"mord mathnormal"},"d"),(0,t.mdx)("span",{parentName:"span",className:"mord"},(0,t.mdx)("span",{parentName:"span",className:"mord mathnormal"},"p"),(0,t.mdx)("span",{parentName:"span",className:"msupsub"},(0,t.mdx)("span",{parentName:"span",className:"vlist-t vlist-t2"},(0,t.mdx)("span",{parentName:"span",className:"vlist-r"},(0,t.mdx)("span",{parentName:"span",className:"vlist",style:{height:"0.31166399999999994em"}},(0,t.mdx)("span",{parentName:"span",style:{top:"-2.5500000000000003em",marginLeft:"0em",marginRight:"0.05em"}},(0,t.mdx)("span",{parentName:"span",className:"pstrut",style:{height:"2.7em"}}),(0,t.mdx)("span",{parentName:"span",className:"sizing reset-size6 size3 mtight"},(0,t.mdx)("span",{parentName:"span",className:"mord mathnormal mtight"},"i")))),(0,t.mdx)("span",{parentName:"span",className:"vlist-s"},"\u200b")),(0,t.mdx)("span",{parentName:"span",className:"vlist-r"},(0,t.mdx)("span",{parentName:"span",className:"vlist",style:{height:"0.15em"}},(0,t.mdx)("span",{parentName:"span"}))))))))),(0,t.mdx)("span",{parentName:"span",className:"vlist-s"},"\u200b")),(0,t.mdx)("span",{parentName:"span",className:"vlist-r"},(0,t.mdx)("span",{parentName:"span",className:"vlist",style:{height:"0.686em"}},(0,t.mdx)("span",{parentName:"span"}))))),(0,t.mdx)("span",{parentName:"span",className:"mclose nulldelimiter"}))))),(0,t.mdx)("span",{parentName:"span",className:"vlist-s"},"\u200b")),(0,t.mdx)("span",{parentName:"span",className:"vlist-r"},(0,t.mdx)("span",{parentName:"span",className:"vlist",style:{height:"2.204660000000001em"}},(0,t.mdx)("span",{parentName:"span"}))))),(0,t.mdx)("span",{parentName:"span",className:"col-align-l"},(0,t.mdx)("span",{parentName:"span",className:"vlist-t vlist-t2"},(0,t.mdx)("span",{parentName:"span",className:"vlist-r"},(0,t.mdx)("span",{parentName:"span",className:"vlist",style:{height:"2.70466em"}},(0,t.mdx)("span",{parentName:"span",style:{top:"-4.70466em"}},(0,t.mdx)("span",{parentName:"span",className:"pstrut",style:{height:"3.3714399999999998em"}}),(0,t.mdx)("span",{parentName:"span",className:"mord"},(0,t.mdx)("span",{parentName:"span",className:"mord"}),(0,t.mdx)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2777777777777778em"}}),(0,t.mdx)("span",{parentName:"span",className:"mrel"},"="),(0,t.mdx)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2777777777777778em"}}),(0,t.mdx)("span",{parentName:"span",className:"mopen"},"["),(0,t.mdx)("span",{parentName:"span",className:"mord"},"\u03a3"),(0,t.mdx)("span",{parentName:"span",className:"mord mathnormal"},"p"),(0,t.mdx)("span",{parentName:"span",className:"mclose"},(0,t.mdx)("span",{parentName:"span",className:"mclose"},"]"),(0,t.mdx)("span",{parentName:"span",className:"msupsub"},(0,t.mdx)("span",{parentName:"span",className:"vlist-t vlist-t2"},(0,t.mdx)("span",{parentName:"span",className:"vlist-r"},(0,t.mdx)("span",{parentName:"span",className:"vlist",style:{height:"0.31166399999999994em"}},(0,t.mdx)("span",{parentName:"span",style:{top:"-2.5500000000000003em",marginLeft:"0em",marginRight:"0.05em"}},(0,t.mdx)("span",{parentName:"span",className:"pstrut",style:{height:"2.7em"}}),(0,t.mdx)("span",{parentName:"span",className:"sizing reset-size6 size3 mtight"},(0,t.mdx)("span",{parentName:"span",className:"mord mathnormal mtight"},"i")))),(0,t.mdx)("span",{parentName:"span",className:"vlist-s"},"\u200b")),(0,t.mdx)("span",{parentName:"span",className:"vlist-r"},(0,t.mdx)("span",{parentName:"span",className:"vlist",style:{height:"0.15em"}},(0,t.mdx)("span",{parentName:"span"})))))))),(0,t.mdx)("span",{parentName:"span",style:{top:"-2.347219999999999em"}},(0,t.mdx)("span",{parentName:"span",className:"pstrut",style:{height:"3.3714399999999998em"}}),(0,t.mdx)("span",{parentName:"span",className:"mord"},(0,t.mdx)("span",{parentName:"span",className:"mord"}),(0,t.mdx)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2777777777777778em"}}),(0,t.mdx)("span",{parentName:"span",className:"mrel"},"="),(0,t.mdx)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2777777777777778em"}}),(0,t.mdx)("span",{parentName:"span",className:"mord"},"\u2212"),(0,t.mdx)("span",{parentName:"span",className:"mord"},(0,t.mdx)("span",{parentName:"span",className:"mopen nulldelimiter"}),(0,t.mdx)("span",{parentName:"span",className:"mfrac"},(0,t.mdx)("span",{parentName:"span",className:"vlist-t vlist-t2"},(0,t.mdx)("span",{parentName:"span",className:"vlist-r"},(0,t.mdx)("span",{parentName:"span",className:"vlist",style:{height:"1.37144em"}},(0,t.mdx)("span",{parentName:"span",style:{top:"-2.314em"}},(0,t.mdx)("span",{parentName:"span",className:"pstrut",style:{height:"3em"}}),(0,t.mdx)("span",{parentName:"span",className:"mord"},(0,t.mdx)("span",{parentName:"span",className:"mord",style:{marginRight:"0.05556em"}},"\u2202"),(0,t.mdx)("span",{parentName:"span",className:"mord"},(0,t.mdx)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.03588em"}},"q"),(0,t.mdx)("span",{parentName:"span",className:"msupsub"},(0,t.mdx)("span",{parentName:"span",className:"vlist-t vlist-t2"},(0,t.mdx)("span",{parentName:"span",className:"vlist-r"},(0,t.mdx)("span",{parentName:"span",className:"vlist",style:{height:"0.31166399999999994em"}},(0,t.mdx)("span",{parentName:"span",style:{top:"-2.5500000000000003em",marginLeft:"-0.03588em",marginRight:"0.05em"}},(0,t.mdx)("span",{parentName:"span",className:"pstrut",style:{height:"2.7em"}}),(0,t.mdx)("span",{parentName:"span",className:"sizing reset-size6 size3 mtight"},(0,t.mdx)("span",{parentName:"span",className:"mord mathnormal mtight"},"i")))),(0,t.mdx)("span",{parentName:"span",className:"vlist-s"},"\u200b")),(0,t.mdx)("span",{parentName:"span",className:"vlist-r"},(0,t.mdx)("span",{parentName:"span",className:"vlist",style:{height:"0.15em"}},(0,t.mdx)("span",{parentName:"span"})))))))),(0,t.mdx)("span",{parentName:"span",style:{top:"-3.23em"}},(0,t.mdx)("span",{parentName:"span",className:"pstrut",style:{height:"3em"}}),(0,t.mdx)("span",{parentName:"span",className:"frac-line",style:{borderBottomWidth:"0.04em"}})),(0,t.mdx)("span",{parentName:"span",style:{top:"-3.677em"}},(0,t.mdx)("span",{parentName:"span",className:"pstrut",style:{height:"3em"}}),(0,t.mdx)("span",{parentName:"span",className:"mord"},(0,t.mdx)("span",{parentName:"span",className:"mord",style:{marginRight:"0.05556em"}},"\u2202"),(0,t.mdx)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.10903em"}},"U")))),(0,t.mdx)("span",{parentName:"span",className:"vlist-s"},"\u200b")),(0,t.mdx)("span",{parentName:"span",className:"vlist-r"},(0,t.mdx)("span",{parentName:"span",className:"vlist",style:{height:"0.8804400000000001em"}},(0,t.mdx)("span",{parentName:"span"}))))),(0,t.mdx)("span",{parentName:"span",className:"mclose nulldelimiter"}))))),(0,t.mdx)("span",{parentName:"span",className:"vlist-s"},"\u200b")),(0,t.mdx)("span",{parentName:"span",className:"vlist-r"},(0,t.mdx)("span",{parentName:"span",className:"vlist",style:{height:"2.204660000000001em"}},(0,t.mdx)("span",{parentName:"span"})))))))))))),(0,t.mdx)("p",null,"Bean Machine can compute ",(0,t.mdx)("span",{parentName:"p",className:"math math-inline"},(0,t.mdx)("span",{parentName:"span",className:"katex"},(0,t.mdx)("span",{parentName:"span",className:"katex-mathml"},(0,t.mdx)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,t.mdx)("semantics",{parentName:"math"},(0,t.mdx)("mrow",{parentName:"semantics"},(0,t.mdx)("mfrac",{parentName:"mrow"},(0,t.mdx)("mrow",{parentName:"mfrac"},(0,t.mdx)("mi",{parentName:"mrow",mathvariant:"normal"},"\u2202"),(0,t.mdx)("mi",{parentName:"mrow"},"U")),(0,t.mdx)("mrow",{parentName:"mfrac"},(0,t.mdx)("mi",{parentName:"mrow",mathvariant:"normal"},"\u2202"),(0,t.mdx)("msub",{parentName:"mrow"},(0,t.mdx)("mi",{parentName:"msub"},"q"),(0,t.mdx)("mi",{parentName:"msub"},"i"))))),(0,t.mdx)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"\\frac{\\partial U}{\\partial q_i}")))),(0,t.mdx)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,t.mdx)("span",{parentName:"span",className:"base"},(0,t.mdx)("span",{parentName:"span",className:"strut",style:{height:"1.3612159999999998em",verticalAlign:"-0.481108em"}}),(0,t.mdx)("span",{parentName:"span",className:"mord"},(0,t.mdx)("span",{parentName:"span",className:"mopen nulldelimiter"}),(0,t.mdx)("span",{parentName:"span",className:"mfrac"},(0,t.mdx)("span",{parentName:"span",className:"vlist-t vlist-t2"},(0,t.mdx)("span",{parentName:"span",className:"vlist-r"},(0,t.mdx)("span",{parentName:"span",className:"vlist",style:{height:"0.8801079999999999em"}},(0,t.mdx)("span",{parentName:"span",style:{top:"-2.6550000000000002em"}},(0,t.mdx)("span",{parentName:"span",className:"pstrut",style:{height:"3em"}}),(0,t.mdx)("span",{parentName:"span",className:"sizing reset-size6 size3 mtight"},(0,t.mdx)("span",{parentName:"span",className:"mord mtight"},(0,t.mdx)("span",{parentName:"span",className:"mord mtight",style:{marginRight:"0.05556em"}},"\u2202"),(0,t.mdx)("span",{parentName:"span",className:"mord mtight"},(0,t.mdx)("span",{parentName:"span",className:"mord mathnormal mtight",style:{marginRight:"0.03588em"}},"q"),(0,t.mdx)("span",{parentName:"span",className:"msupsub"},(0,t.mdx)("span",{parentName:"span",className:"vlist-t vlist-t2"},(0,t.mdx)("span",{parentName:"span",className:"vlist-r"},(0,t.mdx)("span",{parentName:"span",className:"vlist",style:{height:"0.3280857142857143em"}},(0,t.mdx)("span",{parentName:"span",style:{top:"-2.357em",marginLeft:"-0.03588em",marginRight:"0.07142857142857144em"}},(0,t.mdx)("span",{parentName:"span",className:"pstrut",style:{height:"2.5em"}}),(0,t.mdx)("span",{parentName:"span",className:"sizing reset-size3 size1 mtight"},(0,t.mdx)("span",{parentName:"span",className:"mord mathnormal mtight"},"i")))),(0,t.mdx)("span",{parentName:"span",className:"vlist-s"},"\u200b")),(0,t.mdx)("span",{parentName:"span",className:"vlist-r"},(0,t.mdx)("span",{parentName:"span",className:"vlist",style:{height:"0.143em"}},(0,t.mdx)("span",{parentName:"span"}))))))))),(0,t.mdx)("span",{parentName:"span",style:{top:"-3.23em"}},(0,t.mdx)("span",{parentName:"span",className:"pstrut",style:{height:"3em"}}),(0,t.mdx)("span",{parentName:"span",className:"frac-line",style:{borderBottomWidth:"0.04em"}})),(0,t.mdx)("span",{parentName:"span",style:{top:"-3.394em"}},(0,t.mdx)("span",{parentName:"span",className:"pstrut",style:{height:"3em"}}),(0,t.mdx)("span",{parentName:"span",className:"sizing reset-size6 size3 mtight"},(0,t.mdx)("span",{parentName:"span",className:"mord mtight"},(0,t.mdx)("span",{parentName:"span",className:"mord mtight",style:{marginRight:"0.05556em"}},"\u2202"),(0,t.mdx)("span",{parentName:"span",className:"mord mathnormal mtight",style:{marginRight:"0.10903em"}},"U"))))),(0,t.mdx)("span",{parentName:"span",className:"vlist-s"},"\u200b")),(0,t.mdx)("span",{parentName:"span",className:"vlist-r"},(0,t.mdx)("span",{parentName:"span",className:"vlist",style:{height:"0.481108em"}},(0,t.mdx)("span",{parentName:"span"}))))),(0,t.mdx)("span",{parentName:"span",className:"mclose nulldelimiter"}))))))," using autograd."),(0,t.mdx)("p",null,"The goal of these equations is to determine where the new sample will come to rest after a framework-specified path length ",(0,t.mdx)("span",{parentName:"p",className:"math math-inline"},(0,t.mdx)("span",{parentName:"span",className:"katex"},(0,t.mdx)("span",{parentName:"span",className:"katex-mathml"},(0,t.mdx)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,t.mdx)("semantics",{parentName:"math"},(0,t.mdx)("mrow",{parentName:"semantics"},(0,t.mdx)("mi",{parentName:"mrow"},"\u03bb")),(0,t.mdx)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"\\lambda")))),(0,t.mdx)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,t.mdx)("span",{parentName:"span",className:"base"},(0,t.mdx)("span",{parentName:"span",className:"strut",style:{height:"0.69444em",verticalAlign:"0em"}}),(0,t.mdx)("span",{parentName:"span",className:"mord mathnormal"},"\u03bb"))))),'. Both the potential energy (from the posterior\'s likelihood) and the kinetic energy (from the injected "kick") will interact with the sampled value to influence how it travels over the posterior surface.'),(0,t.mdx)("admonition",{type:"caution"},(0,t.mdx)("p",{parentName:"admonition"},"Since we are computing gradients, all of the latent (non-observed) variables must be continuous. For discrete variables, use ",(0,t.mdx)("a",{parentName:"p",href:"/docs/compositional_inference"},(0,t.mdx)("inlineCode",{parentName:"a"},"CompositionalInference"))," or marginalize them out as in the ",(0,t.mdx)("a",{parentName:"p",href:"../overview/tutorials/Zero_inflated_count_data/ZeroInflatedCountData"},"Zero inflated count data tutorial"),".")),(0,t.mdx)("h2",{id:"approximating-hamiltonian-dynamics"},"Approximating Hamiltonian dynamics"),(0,t.mdx)("p",null,"Unfortunately, this system of differential equations cannot be analytically computed. Instead, Bean Machine discretizes these equations based on a discrete time step ",(0,t.mdx)("span",{parentName:"p",className:"math math-inline"},(0,t.mdx)("span",{parentName:"span",className:"katex"},(0,t.mdx)("span",{parentName:"span",className:"katex-mathml"},(0,t.mdx)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,t.mdx)("semantics",{parentName:"math"},(0,t.mdx)("mrow",{parentName:"semantics"},(0,t.mdx)("mi",{parentName:"mrow"},"t")),(0,t.mdx)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"t")))),(0,t.mdx)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,t.mdx)("span",{parentName:"span",className:"base"},(0,t.mdx)("span",{parentName:"span",className:"strut",style:{height:"0.61508em",verticalAlign:"0em"}}),(0,t.mdx)("span",{parentName:"span",className:"mord mathnormal"},"t"))))),", and simulates how they influence each other in this discrete setting for a framework-specified path length ",(0,t.mdx)("span",{parentName:"p",className:"math math-inline"},(0,t.mdx)("span",{parentName:"span",className:"katex"},(0,t.mdx)("span",{parentName:"span",className:"katex-mathml"},(0,t.mdx)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,t.mdx)("semantics",{parentName:"math"},(0,t.mdx)("mrow",{parentName:"semantics"},(0,t.mdx)("mi",{parentName:"mrow"},"\u03bb")),(0,t.mdx)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"\\lambda")))),(0,t.mdx)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,t.mdx)("span",{parentName:"span",className:"base"},(0,t.mdx)("span",{parentName:"span",className:"strut",style:{height:"0.69444em",verticalAlign:"0em"}}),(0,t.mdx)("span",{parentName:"span",className:"mord mathnormal"},"\u03bb"))))),'. This discrete simulation is referred to as the "leapfrog" algorithm. Each simulated time step is referred to as a "leapfrog step".'),(0,t.mdx)("p",null,"At a high level, leapfrog works like this:"),(0,t.mdx)("ol",null,(0,t.mdx)("li",{parentName:"ol"},"Choose momentum (",(0,t.mdx)("span",{parentName:"li",className:"math math-inline"},(0,t.mdx)("span",{parentName:"span",className:"katex"},(0,t.mdx)("span",{parentName:"span",className:"katex-mathml"},(0,t.mdx)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,t.mdx)("semantics",{parentName:"math"},(0,t.mdx)("mrow",{parentName:"semantics"},(0,t.mdx)("mi",{parentName:"mrow"},"p")),(0,t.mdx)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"p")))),(0,t.mdx)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,t.mdx)("span",{parentName:"span",className:"base"},(0,t.mdx)("span",{parentName:"span",className:"strut",style:{height:"0.625em",verticalAlign:"-0.19444em"}}),(0,t.mdx)("span",{parentName:"span",className:"mord mathnormal"},"p"))))),") and covariance (",(0,t.mdx)("span",{parentName:"li",className:"math math-inline"},(0,t.mdx)("span",{parentName:"span",className:"katex"},(0,t.mdx)("span",{parentName:"span",className:"katex-mathml"},(0,t.mdx)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,t.mdx)("semantics",{parentName:"math"},(0,t.mdx)("mrow",{parentName:"semantics"},(0,t.mdx)("mi",{parentName:"mrow",mathvariant:"normal"},"\u03a3")),(0,t.mdx)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"\\Sigma")))),(0,t.mdx)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,t.mdx)("span",{parentName:"span",className:"base"},(0,t.mdx)("span",{parentName:"span",className:"strut",style:{height:"0.68333em",verticalAlign:"0em"}}),(0,t.mdx)("span",{parentName:"span",className:"mord"},"\u03a3"))))),") values to use for the simulation."),(0,t.mdx)("li",{parentName:"ol"},"Simulate a small time step of the momentum's influence on the sample."),(0,t.mdx)("li",{parentName:"ol"},"Simulate a small time step of the potential energy's influence on the sample."),(0,t.mdx)("li",{parentName:"ol"},"Repeat for the framework-specified path length ",(0,t.mdx)("span",{parentName:"li",className:"math math-inline"},(0,t.mdx)("span",{parentName:"span",className:"katex"},(0,t.mdx)("span",{parentName:"span",className:"katex-mathml"},(0,t.mdx)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,t.mdx)("semantics",{parentName:"math"},(0,t.mdx)("mrow",{parentName:"semantics"},(0,t.mdx)("mi",{parentName:"mrow"},"\u03bb")),(0,t.mdx)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"\\lambda")))),(0,t.mdx)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,t.mdx)("span",{parentName:"span",className:"base"},(0,t.mdx)("span",{parentName:"span",className:"strut",style:{height:"0.69444em",verticalAlign:"0em"}}),(0,t.mdx)("span",{parentName:"span",className:"mord mathnormal"},"\u03bb"))))),".")),(0,t.mdx)("p",null,"We'll represent the above description mathematically. For leapfrog step at time ",(0,t.mdx)("span",{parentName:"p",className:"math math-inline"},(0,t.mdx)("span",{parentName:"span",className:"katex"},(0,t.mdx)("span",{parentName:"span",className:"katex-mathml"},(0,t.mdx)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,t.mdx)("semantics",{parentName:"math"},(0,t.mdx)("mrow",{parentName:"semantics"},(0,t.mdx)("mi",{parentName:"mrow"},"t")),(0,t.mdx)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"t")))),(0,t.mdx)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,t.mdx)("span",{parentName:"span",className:"base"},(0,t.mdx)("span",{parentName:"span",className:"strut",style:{height:"0.61508em",verticalAlign:"0em"}}),(0,t.mdx)("span",{parentName:"span",className:"mord mathnormal"},"t")))))," of size ",(0,t.mdx)("span",{parentName:"p",className:"math math-inline"},(0,t.mdx)("span",{parentName:"span",className:"katex"},(0,t.mdx)("span",{parentName:"span",className:"katex-mathml"},(0,t.mdx)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,t.mdx)("semantics",{parentName:"math"},(0,t.mdx)("mrow",{parentName:"semantics"},(0,t.mdx)("mi",{parentName:"mrow"},"\u03f5")),(0,t.mdx)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"\\epsilon")))),(0,t.mdx)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,t.mdx)("span",{parentName:"span",className:"base"},(0,t.mdx)("span",{parentName:"span",className:"strut",style:{height:"0.43056em",verticalAlign:"0em"}}),(0,t.mdx)("span",{parentName:"span",className:"mord mathnormal"},"\u03f5"))))),", we take a half-step for momentum and a full-step for potential energy using the updated momentum, and finally another half step for the momentum."),(0,t.mdx)("div",{className:"math math-display"},(0,t.mdx)("span",{parentName:"div",className:"katex-display"},(0,t.mdx)("span",{parentName:"span",className:"katex"},(0,t.mdx)("span",{parentName:"span",className:"katex-mathml"},(0,t.mdx)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},(0,t.mdx)("semantics",{parentName:"math"},(0,t.mdx)("mtable",{parentName:"semantics",rowspacing:"0.24999999999999992em",columnalign:"right left",columnspacing:"0em"},(0,t.mdx)("mtr",{parentName:"mtable"},(0,t.mdx)("mtd",{parentName:"mtr"},(0,t.mdx)("mstyle",{parentName:"mtd",scriptlevel:"0",displaystyle:"true"},(0,t.mdx)("mrow",{parentName:"mstyle"},(0,t.mdx)("msub",{parentName:"mrow"},(0,t.mdx)("mi",{parentName:"msub"},"p"),(0,t.mdx)("mi",{parentName:"msub"},"i")),(0,t.mdx)("mo",{parentName:"mrow",stretchy:"false"},"("),(0,t.mdx)("mi",{parentName:"mrow"},"t"),(0,t.mdx)("mo",{parentName:"mrow"},"+"),(0,t.mdx)("mi",{parentName:"mrow"},"\u03f5"),(0,t.mdx)("mi",{parentName:"mrow",mathvariant:"normal"},"/"),(0,t.mdx)("mn",{parentName:"mrow"},"2"),(0,t.mdx)("mo",{parentName:"mrow",stretchy:"false"},")")))),(0,t.mdx)("mtd",{parentName:"mtr"},(0,t.mdx)("mstyle",{parentName:"mtd",scriptlevel:"0",displaystyle:"true"},(0,t.mdx)("mrow",{parentName:"mstyle"},(0,t.mdx)("mrow",{parentName:"mrow"}),(0,t.mdx)("mo",{parentName:"mrow"},"="),(0,t.mdx)("mi",{parentName:"mrow"},"p"),(0,t.mdx)("mo",{parentName:"mrow"},"\u2212"),(0,t.mdx)("mo",{parentName:"mrow",stretchy:"false"},"("),(0,t.mdx)("mi",{parentName:"mrow"},"\u03f5"),(0,t.mdx)("mi",{parentName:"mrow",mathvariant:"normal"},"/"),(0,t.mdx)("mn",{parentName:"mrow"},"2"),(0,t.mdx)("mo",{parentName:"mrow",stretchy:"false"},")"),(0,t.mdx)("mfrac",{parentName:"mrow"},(0,t.mdx)("mrow",{parentName:"mfrac"},(0,t.mdx)("mi",{parentName:"mrow",mathvariant:"normal"},"\u2202"),(0,t.mdx)("mi",{parentName:"mrow"},"U")),(0,t.mdx)("mrow",{parentName:"mfrac"},(0,t.mdx)("mi",{parentName:"mrow",mathvariant:"normal"},"\u2202"),(0,t.mdx)("msub",{parentName:"mrow"},(0,t.mdx)("mi",{parentName:"msub"},"q"),(0,t.mdx)("mi",{parentName:"msub"},"i")))),(0,t.mdx)("mo",{parentName:"mrow",stretchy:"false"},"("),(0,t.mdx)("mi",{parentName:"mrow"},"q"),(0,t.mdx)("mo",{parentName:"mrow",stretchy:"false"},"("),(0,t.mdx)("mi",{parentName:"mrow"},"t"),(0,t.mdx)("mo",{parentName:"mrow",stretchy:"false"},")"),(0,t.mdx)("mo",{parentName:"mrow",stretchy:"false"},")"))))),(0,t.mdx)("mtr",{parentName:"mtable"},(0,t.mdx)("mtd",{parentName:"mtr"},(0,t.mdx)("mstyle",{parentName:"mtd",scriptlevel:"0",displaystyle:"true"},(0,t.mdx)("mrow",{parentName:"mstyle"},(0,t.mdx)("msub",{parentName:"mrow"},(0,t.mdx)("mi",{parentName:"msub"},"q"),(0,t.mdx)("mi",{parentName:"msub"},"i")),(0,t.mdx)("mo",{parentName:"mrow",stretchy:"false"},"("),(0,t.mdx)("mi",{parentName:"mrow"},"t"),(0,t.mdx)("mo",{parentName:"mrow"},"+"),(0,t.mdx)("mi",{parentName:"mrow"},"\u03f5"),(0,t.mdx)("mo",{parentName:"mrow",stretchy:"false"},")")))),(0,t.mdx)("mtd",{parentName:"mtr"},(0,t.mdx)("mstyle",{parentName:"mtd",scriptlevel:"0",displaystyle:"true"},(0,t.mdx)("mrow",{parentName:"mstyle"},(0,t.mdx)("mrow",{parentName:"mrow"}),(0,t.mdx)("mo",{parentName:"mrow"},"="),(0,t.mdx)("msub",{parentName:"mrow"},(0,t.mdx)("mi",{parentName:"msub"},"q"),(0,t.mdx)("mi",{parentName:"msub"},"i")),(0,t.mdx)("mo",{parentName:"mrow",stretchy:"false"},"("),(0,t.mdx)("mi",{parentName:"mrow"},"t"),(0,t.mdx)("mo",{parentName:"mrow",stretchy:"false"},")"),(0,t.mdx)("mo",{parentName:"mrow"},"+"),(0,t.mdx)("mi",{parentName:"mrow"},"\u03f5"),(0,t.mdx)("mi",{parentName:"mrow",mathvariant:"normal"},"\u03a3"),(0,t.mdx)("msub",{parentName:"mrow"},(0,t.mdx)("mi",{parentName:"msub"},"p"),(0,t.mdx)("mi",{parentName:"msub"},"i")),(0,t.mdx)("mo",{parentName:"mrow",stretchy:"false"},"("),(0,t.mdx)("mi",{parentName:"mrow"},"t"),(0,t.mdx)("mo",{parentName:"mrow"},"+"),(0,t.mdx)("mi",{parentName:"mrow"},"\u03f5"),(0,t.mdx)("mi",{parentName:"mrow",mathvariant:"normal"},"/"),(0,t.mdx)("mn",{parentName:"mrow"},"2"),(0,t.mdx)("mo",{parentName:"mrow",stretchy:"false"},")"))))),(0,t.mdx)("mtr",{parentName:"mtable"},(0,t.mdx)("mtd",{parentName:"mtr"},(0,t.mdx)("mstyle",{parentName:"mtd",scriptlevel:"0",displaystyle:"true"},(0,t.mdx)("mrow",{parentName:"mstyle"},(0,t.mdx)("msub",{parentName:"mrow"},(0,t.mdx)("mi",{parentName:"msub"},"p"),(0,t.mdx)("mi",{parentName:"msub"},"i")),(0,t.mdx)("mo",{parentName:"mrow",stretchy:"false"},"("),(0,t.mdx)("mi",{parentName:"mrow"},"t"),(0,t.mdx)("mo",{parentName:"mrow"},"+"),(0,t.mdx)("mi",{parentName:"mrow"},"\u03f5"),(0,t.mdx)("mo",{parentName:"mrow",stretchy:"false"},")")))),(0,t.mdx)("mtd",{parentName:"mtr"},(0,t.mdx)("mstyle",{parentName:"mtd",scriptlevel:"0",displaystyle:"true"},(0,t.mdx)("mrow",{parentName:"mstyle"},(0,t.mdx)("mrow",{parentName:"mrow"}),(0,t.mdx)("mo",{parentName:"mrow"},"="),(0,t.mdx)("msub",{parentName:"mrow"},(0,t.mdx)("mi",{parentName:"msub"},"p"),(0,t.mdx)("mi",{parentName:"msub"},"i")),(0,t.mdx)("mo",{parentName:"mrow",stretchy:"false"},"("),(0,t.mdx)("mi",{parentName:"mrow"},"t"),(0,t.mdx)("mo",{parentName:"mrow"},"+"),(0,t.mdx)("mi",{parentName:"mrow"},"\u03f5"),(0,t.mdx)("mi",{parentName:"mrow",mathvariant:"normal"},"/"),(0,t.mdx)("mn",{parentName:"mrow"},"2"),(0,t.mdx)("mo",{parentName:"mrow",stretchy:"false"},")"),(0,t.mdx)("mo",{parentName:"mrow"},"\u2212"),(0,t.mdx)("mo",{parentName:"mrow",stretchy:"false"},"("),(0,t.mdx)("mi",{parentName:"mrow"},"\u03f5"),(0,t.mdx)("mi",{parentName:"mrow",mathvariant:"normal"},"/"),(0,t.mdx)("mn",{parentName:"mrow"},"2"),(0,t.mdx)("mo",{parentName:"mrow",stretchy:"false"},")"),(0,t.mdx)("mfrac",{parentName:"mrow"},(0,t.mdx)("mrow",{parentName:"mfrac"},(0,t.mdx)("mi",{parentName:"mrow",mathvariant:"normal"},"\u2202"),(0,t.mdx)("mi",{parentName:"mrow"},"U")),(0,t.mdx)("mrow",{parentName:"mfrac"},(0,t.mdx)("mi",{parentName:"mrow",mathvariant:"normal"},"\u2202"),(0,t.mdx)("msub",{parentName:"mrow"},(0,t.mdx)("mi",{parentName:"msub"},"q"),(0,t.mdx)("mi",{parentName:"msub"},"i")))),(0,t.mdx)("mo",{parentName:"mrow",stretchy:"false"},"("),(0,t.mdx)("mi",{parentName:"mrow"},"q"),(0,t.mdx)("mo",{parentName:"mrow",stretchy:"false"},"("),(0,t.mdx)("mi",{parentName:"mrow"},"t"),(0,t.mdx)("mo",{parentName:"mrow"},"+"),(0,t.mdx)("mi",{parentName:"mrow"},"\u03f5"),(0,t.mdx)("mo",{parentName:"mrow",stretchy:"false"},")"),(0,t.mdx)("mo",{parentName:"mrow",stretchy:"false"},")")))))),(0,t.mdx)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"\\begin{aligned} p_i(t + \\epsilon/2) &= p - (\\epsilon/2)\\frac{\\partial U}{\\partial q_i}(q(t))\\\\ q_i(t + \\epsilon) &= q_i(t) + \\epsilon \\Sigma p_i(t + \\epsilon/2)\\\\ p_i(t + \\epsilon) &= p_i(t + \\epsilon/2) - (\\epsilon/2)\\frac{\\partial U}{\\partial q_i}(q(t + \\epsilon)) \\end{aligned}")))),(0,t.mdx)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,t.mdx)("span",{parentName:"span",className:"base"},(0,t.mdx)("span",{parentName:"span",className:"strut",style:{height:"6.60376em",verticalAlign:"-3.0518800000000006em"}}),(0,t.mdx)("span",{parentName:"span",className:"mord"},(0,t.mdx)("span",{parentName:"span",className:"mtable"},(0,t.mdx)("span",{parentName:"span",className:"col-align-r"},(0,t.mdx)("span",{parentName:"span",className:"vlist-t vlist-t2"},(0,t.mdx)("span",{parentName:"span",className:"vlist-r"},(0,t.mdx)("span",{parentName:"span",className:"vlist",style:{height:"3.5518799999999997em"}},(0,t.mdx)("span",{parentName:"span",style:{top:"-5.55188em"}},(0,t.mdx)("span",{parentName:"span",className:"pstrut",style:{height:"3.3714399999999998em"}}),(0,t.mdx)("span",{parentName:"span",className:"mord"},(0,t.mdx)("span",{parentName:"span",className:"mord"},(0,t.mdx)("span",{parentName:"span",className:"mord mathnormal"},"p"),(0,t.mdx)("span",{parentName:"span",className:"msupsub"},(0,t.mdx)("span",{parentName:"span",className:"vlist-t vlist-t2"},(0,t.mdx)("span",{parentName:"span",className:"vlist-r"},(0,t.mdx)("span",{parentName:"span",className:"vlist",style:{height:"0.31166399999999994em"}},(0,t.mdx)("span",{parentName:"span",style:{top:"-2.5500000000000003em",marginLeft:"0em",marginRight:"0.05em"}},(0,t.mdx)("span",{parentName:"span",className:"pstrut",style:{height:"2.7em"}}),(0,t.mdx)("span",{parentName:"span",className:"sizing reset-size6 size3 mtight"},(0,t.mdx)("span",{parentName:"span",className:"mord mathnormal mtight"},"i")))),(0,t.mdx)("span",{parentName:"span",className:"vlist-s"},"\u200b")),(0,t.mdx)("span",{parentName:"span",className:"vlist-r"},(0,t.mdx)("span",{parentName:"span",className:"vlist",style:{height:"0.15em"}},(0,t.mdx)("span",{parentName:"span"})))))),(0,t.mdx)("span",{parentName:"span",className:"mopen"},"("),(0,t.mdx)("span",{parentName:"span",className:"mord mathnormal"},"t"),(0,t.mdx)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2222222222222222em"}}),(0,t.mdx)("span",{parentName:"span",className:"mbin"},"+"),(0,t.mdx)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2222222222222222em"}}),(0,t.mdx)("span",{parentName:"span",className:"mord mathnormal"},"\u03f5"),(0,t.mdx)("span",{parentName:"span",className:"mord"},"/"),(0,t.mdx)("span",{parentName:"span",className:"mord"},"2"),(0,t.mdx)("span",{parentName:"span",className:"mclose"},")"))),(0,t.mdx)("span",{parentName:"span",style:{top:"-3.531439999999999em"}},(0,t.mdx)("span",{parentName:"span",className:"pstrut",style:{height:"3.3714399999999998em"}}),(0,t.mdx)("span",{parentName:"span",className:"mord"},(0,t.mdx)("span",{parentName:"span",className:"mord"},(0,t.mdx)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.03588em"}},"q"),(0,t.mdx)("span",{parentName:"span",className:"msupsub"},(0,t.mdx)("span",{parentName:"span",className:"vlist-t vlist-t2"},(0,t.mdx)("span",{parentName:"span",className:"vlist-r"},(0,t.mdx)("span",{parentName:"span",className:"vlist",style:{height:"0.31166399999999994em"}},(0,t.mdx)("span",{parentName:"span",style:{top:"-2.5500000000000003em",marginLeft:"-0.03588em",marginRight:"0.05em"}},(0,t.mdx)("span",{parentName:"span",className:"pstrut",style:{height:"2.7em"}}),(0,t.mdx)("span",{parentName:"span",className:"sizing reset-size6 size3 mtight"},(0,t.mdx)("span",{parentName:"span",className:"mord mathnormal mtight"},"i")))),(0,t.mdx)("span",{parentName:"span",className:"vlist-s"},"\u200b")),(0,t.mdx)("span",{parentName:"span",className:"vlist-r"},(0,t.mdx)("span",{parentName:"span",className:"vlist",style:{height:"0.15em"}},(0,t.mdx)("span",{parentName:"span"})))))),(0,t.mdx)("span",{parentName:"span",className:"mopen"},"("),(0,t.mdx)("span",{parentName:"span",className:"mord mathnormal"},"t"),(0,t.mdx)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2222222222222222em"}}),(0,t.mdx)("span",{parentName:"span",className:"mbin"},"+"),(0,t.mdx)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2222222222222222em"}}),(0,t.mdx)("span",{parentName:"span",className:"mord mathnormal"},"\u03f5"),(0,t.mdx)("span",{parentName:"span",className:"mclose"},")"))),(0,t.mdx)("span",{parentName:"span",style:{top:"-1.4999999999999993em"}},(0,t.mdx)("span",{parentName:"span",className:"pstrut",style:{height:"3.3714399999999998em"}}),(0,t.mdx)("span",{parentName:"span",className:"mord"},(0,t.mdx)("span",{parentName:"span",className:"mord"},(0,t.mdx)("span",{parentName:"span",className:"mord mathnormal"},"p"),(0,t.mdx)("span",{parentName:"span",className:"msupsub"},(0,t.mdx)("span",{parentName:"span",className:"vlist-t vlist-t2"},(0,t.mdx)("span",{parentName:"span",className:"vlist-r"},(0,t.mdx)("span",{parentName:"span",className:"vlist",style:{height:"0.31166399999999994em"}},(0,t.mdx)("span",{parentName:"span",style:{top:"-2.5500000000000003em",marginLeft:"0em",marginRight:"0.05em"}},(0,t.mdx)("span",{parentName:"span",className:"pstrut",style:{height:"2.7em"}}),(0,t.mdx)("span",{parentName:"span",className:"sizing reset-size6 size3 mtight"},(0,t.mdx)("span",{parentName:"span",className:"mord mathnormal mtight"},"i")))),(0,t.mdx)("span",{parentName:"span",className:"vlist-s"},"\u200b")),(0,t.mdx)("span",{parentName:"span",className:"vlist-r"},(0,t.mdx)("span",{parentName:"span",className:"vlist",style:{height:"0.15em"}},(0,t.mdx)("span",{parentName:"span"})))))),(0,t.mdx)("span",{parentName:"span",className:"mopen"},"("),(0,t.mdx)("span",{parentName:"span",className:"mord mathnormal"},"t"),(0,t.mdx)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2222222222222222em"}}),(0,t.mdx)("span",{parentName:"span",className:"mbin"},"+"),(0,t.mdx)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2222222222222222em"}}),(0,t.mdx)("span",{parentName:"span",className:"mord mathnormal"},"\u03f5"),(0,t.mdx)("span",{parentName:"span",className:"mclose"},")")))),(0,t.mdx)("span",{parentName:"span",className:"vlist-s"},"\u200b")),(0,t.mdx)("span",{parentName:"span",className:"vlist-r"},(0,t.mdx)("span",{parentName:"span",className:"vlist",style:{height:"3.0518800000000006em"}},(0,t.mdx)("span",{parentName:"span"}))))),(0,t.mdx)("span",{parentName:"span",className:"col-align-l"},(0,t.mdx)("span",{parentName:"span",className:"vlist-t vlist-t2"},(0,t.mdx)("span",{parentName:"span",className:"vlist-r"},(0,t.mdx)("span",{parentName:"span",className:"vlist",style:{height:"3.5518799999999997em"}},(0,t.mdx)("span",{parentName:"span",style:{top:"-5.55188em"}},(0,t.mdx)("span",{parentName:"span",className:"pstrut",style:{height:"3.3714399999999998em"}}),(0,t.mdx)("span",{parentName:"span",className:"mord"},(0,t.mdx)("span",{parentName:"span",className:"mord"}),(0,t.mdx)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2777777777777778em"}}),(0,t.mdx)("span",{parentName:"span",className:"mrel"},"="),(0,t.mdx)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2777777777777778em"}}),(0,t.mdx)("span",{parentName:"span",className:"mord mathnormal"},"p"),(0,t.mdx)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2222222222222222em"}}),(0,t.mdx)("span",{parentName:"span",className:"mbin"},"\u2212"),(0,t.mdx)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2222222222222222em"}}),(0,t.mdx)("span",{parentName:"span",className:"mopen"},"("),(0,t.mdx)("span",{parentName:"span",className:"mord mathnormal"},"\u03f5"),(0,t.mdx)("span",{parentName:"span",className:"mord"},"/"),(0,t.mdx)("span",{parentName:"span",className:"mord"},"2"),(0,t.mdx)("span",{parentName:"span",className:"mclose"},")"),(0,t.mdx)("span",{parentName:"span",className:"mord"},(0,t.mdx)("span",{parentName:"span",className:"mopen nulldelimiter"}),(0,t.mdx)("span",{parentName:"span",className:"mfrac"},(0,t.mdx)("span",{parentName:"span",className:"vlist-t vlist-t2"},(0,t.mdx)("span",{parentName:"span",className:"vlist-r"},(0,t.mdx)("span",{parentName:"span",className:"vlist",style:{height:"1.37144em"}},(0,t.mdx)("span",{parentName:"span",style:{top:"-2.314em"}},(0,t.mdx)("span",{parentName:"span",className:"pstrut",style:{height:"3em"}}),(0,t.mdx)("span",{parentName:"span",className:"mord"},(0,t.mdx)("span",{parentName:"span",className:"mord",style:{marginRight:"0.05556em"}},"\u2202"),(0,t.mdx)("span",{parentName:"span",className:"mord"},(0,t.mdx)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.03588em"}},"q"),(0,t.mdx)("span",{parentName:"span",className:"msupsub"},(0,t.mdx)("span",{parentName:"span",className:"vlist-t vlist-t2"},(0,t.mdx)("span",{parentName:"span",className:"vlist-r"},(0,t.mdx)("span",{parentName:"span",className:"vlist",style:{height:"0.31166399999999994em"}},(0,t.mdx)("span",{parentName:"span",style:{top:"-2.5500000000000003em",marginLeft:"-0.03588em",marginRight:"0.05em"}},(0,t.mdx)("span",{parentName:"span",className:"pstrut",style:{height:"2.7em"}}),(0,t.mdx)("span",{parentName:"span",className:"sizing reset-size6 size3 mtight"},(0,t.mdx)("span",{parentName:"span",className:"mord mathnormal mtight"},"i")))),(0,t.mdx)("span",{parentName:"span",className:"vlist-s"},"\u200b")),(0,t.mdx)("span",{parentName:"span",className:"vlist-r"},(0,t.mdx)("span",{parentName:"span",className:"vlist",style:{height:"0.15em"}},(0,t.mdx)("span",{parentName:"span"})))))))),(0,t.mdx)("span",{parentName:"span",style:{top:"-3.23em"}},(0,t.mdx)("span",{parentName:"span",className:"pstrut",style:{height:"3em"}}),(0,t.mdx)("span",{parentName:"span",className:"frac-line",style:{borderBottomWidth:"0.04em"}})),(0,t.mdx)("span",{parentName:"span",style:{top:"-3.677em"}},(0,t.mdx)("span",{parentName:"span",className:"pstrut",style:{height:"3em"}}),(0,t.mdx)("span",{parentName:"span",className:"mord"},(0,t.mdx)("span",{parentName:"span",className:"mord",style:{marginRight:"0.05556em"}},"\u2202"),(0,t.mdx)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.10903em"}},"U")))),(0,t.mdx)("span",{parentName:"span",className:"vlist-s"},"\u200b")),(0,t.mdx)("span",{parentName:"span",className:"vlist-r"},(0,t.mdx)("span",{parentName:"span",className:"vlist",style:{height:"0.8804400000000001em"}},(0,t.mdx)("span",{parentName:"span"}))))),(0,t.mdx)("span",{parentName:"span",className:"mclose nulldelimiter"})),(0,t.mdx)("span",{parentName:"span",className:"mopen"},"("),(0,t.mdx)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.03588em"}},"q"),(0,t.mdx)("span",{parentName:"span",className:"mopen"},"("),(0,t.mdx)("span",{parentName:"span",className:"mord mathnormal"},"t"),(0,t.mdx)("span",{parentName:"span",className:"mclose"},")"),(0,t.mdx)("span",{parentName:"span",className:"mclose"},")"))),(0,t.mdx)("span",{parentName:"span",style:{top:"-3.531439999999999em"}},(0,t.mdx)("span",{parentName:"span",className:"pstrut",style:{height:"3.3714399999999998em"}}),(0,t.mdx)("span",{parentName:"span",className:"mord"},(0,t.mdx)("span",{parentName:"span",className:"mord"}),(0,t.mdx)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2777777777777778em"}}),(0,t.mdx)("span",{parentName:"span",className:"mrel"},"="),(0,t.mdx)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2777777777777778em"}}),(0,t.mdx)("span",{parentName:"span",className:"mord"},(0,t.mdx)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.03588em"}},"q"),(0,t.mdx)("span",{parentName:"span",className:"msupsub"},(0,t.mdx)("span",{parentName:"span",className:"vlist-t vlist-t2"},(0,t.mdx)("span",{parentName:"span",className:"vlist-r"},(0,t.mdx)("span",{parentName:"span",className:"vlist",style:{height:"0.31166399999999994em"}},(0,t.mdx)("span",{parentName:"span",style:{top:"-2.5500000000000003em",marginLeft:"-0.03588em",marginRight:"0.05em"}},(0,t.mdx)("span",{parentName:"span",className:"pstrut",style:{height:"2.7em"}}),(0,t.mdx)("span",{parentName:"span",className:"sizing reset-size6 size3 mtight"},(0,t.mdx)("span",{parentName:"span",className:"mord mathnormal mtight"},"i")))),(0,t.mdx)("span",{parentName:"span",className:"vlist-s"},"\u200b")),(0,t.mdx)("span",{parentName:"span",className:"vlist-r"},(0,t.mdx)("span",{parentName:"span",className:"vlist",style:{height:"0.15em"}},(0,t.mdx)("span",{parentName:"span"})))))),(0,t.mdx)("span",{parentName:"span",className:"mopen"},"("),(0,t.mdx)("span",{parentName:"span",className:"mord mathnormal"},"t"),(0,t.mdx)("span",{parentName:"span",className:"mclose"},")"),(0,t.mdx)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2222222222222222em"}}),(0,t.mdx)("span",{parentName:"span",className:"mbin"},"+"),(0,t.mdx)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2222222222222222em"}}),(0,t.mdx)("span",{parentName:"span",className:"mord mathnormal"},"\u03f5"),(0,t.mdx)("span",{parentName:"span",className:"mord"},"\u03a3"),(0,t.mdx)("span",{parentName:"span",className:"mord"},(0,t.mdx)("span",{parentName:"span",className:"mord mathnormal"},"p"),(0,t.mdx)("span",{parentName:"span",className:"msupsub"},(0,t.mdx)("span",{parentName:"span",className:"vlist-t vlist-t2"},(0,t.mdx)("span",{parentName:"span",className:"vlist-r"},(0,t.mdx)("span",{parentName:"span",className:"vlist",style:{height:"0.31166399999999994em"}},(0,t.mdx)("span",{parentName:"span",style:{top:"-2.5500000000000003em",marginLeft:"0em",marginRight:"0.05em"}},(0,t.mdx)("span",{parentName:"span",className:"pstrut",style:{height:"2.7em"}}),(0,t.mdx)("span",{parentName:"span",className:"sizing reset-size6 size3 mtight"},(0,t.mdx)("span",{parentName:"span",className:"mord mathnormal mtight"},"i")))),(0,t.mdx)("span",{parentName:"span",className:"vlist-s"},"\u200b")),(0,t.mdx)("span",{parentName:"span",className:"vlist-r"},(0,t.mdx)("span",{parentName:"span",className:"vlist",style:{height:"0.15em"}},(0,t.mdx)("span",{parentName:"span"})))))),(0,t.mdx)("span",{parentName:"span",className:"mopen"},"("),(0,t.mdx)("span",{parentName:"span",className:"mord mathnormal"},"t"),(0,t.mdx)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2222222222222222em"}}),(0,t.mdx)("span",{parentName:"span",className:"mbin"},"+"),(0,t.mdx)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2222222222222222em"}}),(0,t.mdx)("span",{parentName:"span",className:"mord mathnormal"},"\u03f5"),(0,t.mdx)("span",{parentName:"span",className:"mord"},"/"),(0,t.mdx)("span",{parentName:"span",className:"mord"},"2"),(0,t.mdx)("span",{parentName:"span",className:"mclose"},")"))),(0,t.mdx)("span",{parentName:"span",style:{top:"-1.4999999999999993em"}},(0,t.mdx)("span",{parentName:"span",className:"pstrut",style:{height:"3.3714399999999998em"}}),(0,t.mdx)("span",{parentName:"span",className:"mord"},(0,t.mdx)("span",{parentName:"span",className:"mord"}),(0,t.mdx)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2777777777777778em"}}),(0,t.mdx)("span",{parentName:"span",className:"mrel"},"="),(0,t.mdx)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2777777777777778em"}}),(0,t.mdx)("span",{parentName:"span",className:"mord"},(0,t.mdx)("span",{parentName:"span",className:"mord mathnormal"},"p"),(0,t.mdx)("span",{parentName:"span",className:"msupsub"},(0,t.mdx)("span",{parentName:"span",className:"vlist-t vlist-t2"},(0,t.mdx)("span",{parentName:"span",className:"vlist-r"},(0,t.mdx)("span",{parentName:"span",className:"vlist",style:{height:"0.31166399999999994em"}},(0,t.mdx)("span",{parentName:"span",style:{top:"-2.5500000000000003em",marginLeft:"0em",marginRight:"0.05em"}},(0,t.mdx)("span",{parentName:"span",className:"pstrut",style:{height:"2.7em"}}),(0,t.mdx)("span",{parentName:"span",className:"sizing reset-size6 size3 mtight"},(0,t.mdx)("span",{parentName:"span",className:"mord mathnormal mtight"},"i")))),(0,t.mdx)("span",{parentName:"span",className:"vlist-s"},"\u200b")),(0,t.mdx)("span",{parentName:"span",className:"vlist-r"},(0,t.mdx)("span",{parentName:"span",className:"vlist",style:{height:"0.15em"}},(0,t.mdx)("span",{parentName:"span"})))))),(0,t.mdx)("span",{parentName:"span",className:"mopen"},"("),(0,t.mdx)("span",{parentName:"span",className:"mord mathnormal"},"t"),(0,t.mdx)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2222222222222222em"}}),(0,t.mdx)("span",{parentName:"span",className:"mbin"},"+"),(0,t.mdx)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2222222222222222em"}}),(0,t.mdx)("span",{parentName:"span",className:"mord mathnormal"},"\u03f5"),(0,t.mdx)("span",{parentName:"span",className:"mord"},"/"),(0,t.mdx)("span",{parentName:"span",className:"mord"},"2"),(0,t.mdx)("span",{parentName:"span",className:"mclose"},")"),(0,t.mdx)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2222222222222222em"}}),(0,t.mdx)("span",{parentName:"span",className:"mbin"},"\u2212"),(0,t.mdx)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2222222222222222em"}}),(0,t.mdx)("span",{parentName:"span",className:"mopen"},"("),(0,t.mdx)("span",{parentName:"span",className:"mord mathnormal"},"\u03f5"),(0,t.mdx)("span",{parentName:"span",className:"mord"},"/"),(0,t.mdx)("span",{parentName:"span",className:"mord"},"2"),(0,t.mdx)("span",{parentName:"span",className:"mclose"},")"),(0,t.mdx)("span",{parentName:"span",className:"mord"},(0,t.mdx)("span",{parentName:"span",className:"mopen nulldelimiter"}),(0,t.mdx)("span",{parentName:"span",className:"mfrac"},(0,t.mdx)("span",{parentName:"span",className:"vlist-t vlist-t2"},(0,t.mdx)("span",{parentName:"span",className:"vlist-r"},(0,t.mdx)("span",{parentName:"span",className:"vlist",style:{height:"1.37144em"}},(0,t.mdx)("span",{parentName:"span",style:{top:"-2.314em"}},(0,t.mdx)("span",{parentName:"span",className:"pstrut",style:{height:"3em"}}),(0,t.mdx)("span",{parentName:"span",className:"mord"},(0,t.mdx)("span",{parentName:"span",className:"mord",style:{marginRight:"0.05556em"}},"\u2202"),(0,t.mdx)("span",{parentName:"span",className:"mord"},(0,t.mdx)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.03588em"}},"q"),(0,t.mdx)("span",{parentName:"span",className:"msupsub"},(0,t.mdx)("span",{parentName:"span",className:"vlist-t vlist-t2"},(0,t.mdx)("span",{parentName:"span",className:"vlist-r"},(0,t.mdx)("span",{parentName:"span",className:"vlist",style:{height:"0.31166399999999994em"}},(0,t.mdx)("span",{parentName:"span",style:{top:"-2.5500000000000003em",marginLeft:"-0.03588em",marginRight:"0.05em"}},(0,t.mdx)("span",{parentName:"span",className:"pstrut",style:{height:"2.7em"}}),(0,t.mdx)("span",{parentName:"span",className:"sizing reset-size6 size3 mtight"},(0,t.mdx)("span",{parentName:"span",className:"mord mathnormal mtight"},"i")))),(0,t.mdx)("span",{parentName:"span",className:"vlist-s"},"\u200b")),(0,t.mdx)("span",{parentName:"span",className:"vlist-r"},(0,t.mdx)("span",{parentName:"span",className:"vlist",style:{height:"0.15em"}},(0,t.mdx)("span",{parentName:"span"})))))))),(0,t.mdx)("span",{parentName:"span",style:{top:"-3.23em"}},(0,t.mdx)("span",{parentName:"span",className:"pstrut",style:{height:"3em"}}),(0,t.mdx)("span",{parentName:"span",className:"frac-line",style:{borderBottomWidth:"0.04em"}})),(0,t.mdx)("span",{parentName:"span",style:{top:"-3.677em"}},(0,t.mdx)("span",{parentName:"span",className:"pstrut",style:{height:"3em"}}),(0,t.mdx)("span",{parentName:"span",className:"mord"},(0,t.mdx)("span",{parentName:"span",className:"mord",style:{marginRight:"0.05556em"}},"\u2202"),(0,t.mdx)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.10903em"}},"U")))),(0,t.mdx)("span",{parentName:"span",className:"vlist-s"},"\u200b")),(0,t.mdx)("span",{parentName:"span",className:"vlist-r"},(0,t.mdx)("span",{parentName:"span",className:"vlist",style:{height:"0.8804400000000001em"}},(0,t.mdx)("span",{parentName:"span"}))))),(0,t.mdx)("span",{parentName:"span",className:"mclose nulldelimiter"})),(0,t.mdx)("span",{parentName:"span",className:"mopen"},"("),(0,t.mdx)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.03588em"}},"q"),(0,t.mdx)("span",{parentName:"span",className:"mopen"},"("),(0,t.mdx)("span",{parentName:"span",className:"mord mathnormal"},"t"),(0,t.mdx)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2222222222222222em"}}),(0,t.mdx)("span",{parentName:"span",className:"mbin"},"+"),(0,t.mdx)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2222222222222222em"}}),(0,t.mdx)("span",{parentName:"span",className:"mord mathnormal"},"\u03f5"),(0,t.mdx)("span",{parentName:"span",className:"mclose"},")"),(0,t.mdx)("span",{parentName:"span",className:"mclose"},")")))),(0,t.mdx)("span",{parentName:"span",className:"vlist-s"},"\u200b")),(0,t.mdx)("span",{parentName:"span",className:"vlist-r"},(0,t.mdx)("span",{parentName:"span",className:"vlist",style:{height:"3.0518800000000006em"}},(0,t.mdx)("span",{parentName:"span"})))))))))))),(0,t.mdx)("p",null,"This process is repeated until we have achieved the framework-specific distance ",(0,t.mdx)("span",{parentName:"p",className:"math math-inline"},(0,t.mdx)("span",{parentName:"span",className:"katex"},(0,t.mdx)("span",{parentName:"span",className:"katex-mathml"},(0,t.mdx)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,t.mdx)("semantics",{parentName:"math"},(0,t.mdx)("mrow",{parentName:"semantics"},(0,t.mdx)("mi",{parentName:"mrow"},"\u03bb")),(0,t.mdx)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"\\lambda")))),(0,t.mdx)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,t.mdx)("span",{parentName:"span",className:"base"},(0,t.mdx)("span",{parentName:"span",className:"strut",style:{height:"0.69444em",verticalAlign:"0em"}}),(0,t.mdx)("span",{parentName:"span",className:"mord mathnormal"},"\u03bb"))))),". Thus, the number of leapfrog steps is calculated by ",(0,t.mdx)("span",{parentName:"p",className:"math math-inline"},(0,t.mdx)("span",{parentName:"span",className:"katex"},(0,t.mdx)("span",{parentName:"span",className:"katex-mathml"},(0,t.mdx)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,t.mdx)("semantics",{parentName:"math"},(0,t.mdx)("mrow",{parentName:"semantics"},(0,t.mdx)("mo",{parentName:"mrow",stretchy:"false"},"\u2308"),(0,t.mdx)("mi",{parentName:"mrow"},"\u03bb"),(0,t.mdx)("mi",{parentName:"mrow",mathvariant:"normal"},"/"),(0,t.mdx)("mi",{parentName:"mrow"},"\u03f5"),(0,t.mdx)("mo",{parentName:"mrow",stretchy:"false"},"\u2309")),(0,t.mdx)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"\\lceil\\lambda / \\epsilon\\rceil")))),(0,t.mdx)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,t.mdx)("span",{parentName:"span",className:"base"},(0,t.mdx)("span",{parentName:"span",className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,t.mdx)("span",{parentName:"span",className:"mopen"},"\u2308"),(0,t.mdx)("span",{parentName:"span",className:"mord mathnormal"},"\u03bb"),(0,t.mdx)("span",{parentName:"span",className:"mord"},"/"),(0,t.mdx)("span",{parentName:"span",className:"mord mathnormal"},"\u03f5"),(0,t.mdx)("span",{parentName:"span",className:"mclose"},"\u2309"))))),". The final sample for ",(0,t.mdx)("span",{parentName:"p",className:"math math-inline"},(0,t.mdx)("span",{parentName:"span",className:"katex"},(0,t.mdx)("span",{parentName:"span",className:"katex-mathml"},(0,t.mdx)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,t.mdx)("semantics",{parentName:"math"},(0,t.mdx)("mrow",{parentName:"semantics"},(0,t.mdx)("mi",{parentName:"mrow"},"q")),(0,t.mdx)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"q")))),(0,t.mdx)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,t.mdx)("span",{parentName:"span",className:"base"},(0,t.mdx)("span",{parentName:"span",className:"strut",style:{height:"0.625em",verticalAlign:"-0.19444em"}}),(0,t.mdx)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.03588em"}},"q")))))," is chosen by the value of ",(0,t.mdx)("span",{parentName:"p",className:"math math-inline"},(0,t.mdx)("span",{parentName:"span",className:"katex"},(0,t.mdx)("span",{parentName:"span",className:"katex-mathml"},(0,t.mdx)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,t.mdx)("semantics",{parentName:"math"},(0,t.mdx)("mrow",{parentName:"semantics"},(0,t.mdx)("mi",{parentName:"mrow"},"q")),(0,t.mdx)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"q")))),(0,t.mdx)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,t.mdx)("span",{parentName:"span",className:"base"},(0,t.mdx)("span",{parentName:"span",className:"strut",style:{height:"0.625em",verticalAlign:"-0.19444em"}}),(0,t.mdx)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.03588em"}},"q")))))," after the last leapfrog step."),(0,t.mdx)("p",null,"Due to the discretization, the resulting trajectory will contain numerical errors. To account for the error, a ",(0,t.mdx)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Metropolis%E2%80%93Hastings_algorithm#Formal_derivation"},"Metropolis acceptance probability")," will be used to determine whether to accept the proposed value for ",(0,t.mdx)("span",{parentName:"p",className:"math math-inline"},(0,t.mdx)("span",{parentName:"span",className:"katex"},(0,t.mdx)("span",{parentName:"span",className:"katex-mathml"},(0,t.mdx)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,t.mdx)("semantics",{parentName:"math"},(0,t.mdx)("mrow",{parentName:"semantics"},(0,t.mdx)("mi",{parentName:"mrow"},"q")),(0,t.mdx)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"q")))),(0,t.mdx)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,t.mdx)("span",{parentName:"span",className:"base"},(0,t.mdx)("span",{parentName:"span",className:"strut",style:{height:"0.625em",verticalAlign:"-0.19444em"}}),(0,t.mdx)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.03588em"}},"q"))))),"."),(0,t.mdx)("p",null,"HMC's performance is quite sensitive to the hyperparameters used. They are as follows:"),(0,t.mdx)("ul",null,(0,t.mdx)("li",{parentName:"ul"},(0,t.mdx)("strong",{parentName:"li"},"Path length, ",(0,t.mdx)("span",{parentName:"strong",className:"math math-inline"},(0,t.mdx)("span",{parentName:"span",className:"katex"},(0,t.mdx)("span",{parentName:"span",className:"katex-mathml"},(0,t.mdx)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,t.mdx)("semantics",{parentName:"math"},(0,t.mdx)("mrow",{parentName:"semantics"},(0,t.mdx)("mi",{parentName:"mrow"},"\u03bb")),(0,t.mdx)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"\\lambda")))),(0,t.mdx)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,t.mdx)("span",{parentName:"span",className:"base"},(0,t.mdx)("span",{parentName:"span",className:"strut",style:{height:"0.69444em",verticalAlign:"0em"}}),(0,t.mdx)("span",{parentName:"span",className:"mord mathnormal"},"\u03bb"))))),".")," Because the samples should be minimally correlated, it is ideal to follow the trajectory for long path lengths. However, distributions may have periodic behavior, and long path lengths may waste computation. The ideal path length is the minimal path length where the starting and ending samples have low correlation."),(0,t.mdx)("li",{parentName:"ul"},(0,t.mdx)("strong",{parentName:"li"},"Step size, ",(0,t.mdx)("span",{parentName:"strong",className:"math math-inline"},(0,t.mdx)("span",{parentName:"span",className:"katex"},(0,t.mdx)("span",{parentName:"span",className:"katex-mathml"},(0,t.mdx)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,t.mdx)("semantics",{parentName:"math"},(0,t.mdx)("mrow",{parentName:"semantics"},(0,t.mdx)("mi",{parentName:"mrow"},"\u03f5")),(0,t.mdx)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"\\epsilon")))),(0,t.mdx)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,t.mdx)("span",{parentName:"span",className:"base"},(0,t.mdx)("span",{parentName:"span",className:"strut",style:{height:"0.43056em",verticalAlign:"0em"}}),(0,t.mdx)("span",{parentName:"span",className:"mord mathnormal"},"\u03f5"))))),".")," If the Hamiltonian equations were followed exactly (not approximated), all samples would be accepted. However, error is introduced into the system during the discretization of Hamilton's equations. The larger the step size, the worse the final approximation will be; however, if the steps are too small, the number of steps needed as well as the overall runtime of the algorithm will increase."),(0,t.mdx)("li",{parentName:"ul"},(0,t.mdx)("strong",{parentName:"li"},"Covariance (mass) matrix, ",(0,t.mdx)("span",{parentName:"strong",className:"math math-inline"},(0,t.mdx)("span",{parentName:"span",className:"katex"},(0,t.mdx)("span",{parentName:"span",className:"katex-mathml"},(0,t.mdx)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,t.mdx)("semantics",{parentName:"math"},(0,t.mdx)("mrow",{parentName:"semantics"},(0,t.mdx)("mi",{parentName:"mrow",mathvariant:"normal"},"\u03a3")),(0,t.mdx)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"\\Sigma")))),(0,t.mdx)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,t.mdx)("span",{parentName:"span",className:"base"},(0,t.mdx)("span",{parentName:"span",className:"strut",style:{height:"0.68333em",verticalAlign:"0em"}}),(0,t.mdx)("span",{parentName:"span",className:"mord"},"\u03a3")))))),". If there is significant correlations between the variables and the covariance matrix is not properly tuned, we will need to make smaller steps to get samples that are likely to be accepted.")),(0,t.mdx)("p",null,"The optimal acceptance rate for HMC, as derived by Neal (2011), is 0.65. It is desirable to tune these parameters so that they acheive this acceptance rate on average."),(0,t.mdx)("h2",{id:"adaptive-hamiltonian-monte-carlo"},"Adaptive Hamiltonian Monte Carlo"),(0,t.mdx)("p",null,"Due to the challenge of selecting good hyperparameters, Bean Machine provides extensions to HMC to help choose appropriate values."),(0,t.mdx)("p",null,"One such extension is called Adaptive Hamiltonian Monte Carlo. Adaptive HMC Adaptive HMC requires an adaptive phase, where Bean Machine uses the HMC algorithm to generate samples while tuning HMC's step size and covariance matrix. Adaptive HMC provides two main improvements over HMC, outlined below."),(0,t.mdx)("p",null,(0,t.mdx)("strong",{parentName:"p"},"Users do not have to specify a step size.")," During the adaptive phase, the step size is adjusted in order to achieve the optimal acceptance rate of 0.65 on average. If the acceptance rate is above optimal, then Bean Machine is being too careful and discretizing in steps that are too small; therefore, the step size should be increased. If the acceptance rate is too low, then the step size should be decreased. We follow the ",(0,t.mdx)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Stochastic_approximation#Robbins%E2%80%93Monro_algorithm"},"Robbins-Monro stochastic approximation method"),", where earlier iterations within the adaptive phase have a larger influence over the step size than later iterations."),(0,t.mdx)("p",null,(0,t.mdx)("strong",{parentName:"p"},"HMC can take different step sizes in different dimensions.")," During the adaptive phase, the momentum in each dimension is tuned depending on the covariance of the previously-accepted samples. The amount of momentum used is controlled by the covariance matrix, which allows HMC to move adjust the dimensions at different rates. The estimated covariance matrix is adjusted based on the covariance of the samples. Since the ideal covariance matrix is the true covariance, we can approximate this during the adaptive phase by using the covariance of the samples."),(0,t.mdx)("p",null,"Once the adaptive phase ends, we no longer update our parameters, and the original HMC algorithm is used to generate new samples. Since the samples generated during the adaptive phase use untuned parameters, they may not be of the highest quality and are not returned by default."),(0,t.mdx)("h2",{id:"tuning-the-path-length"},"Tuning the path length"),(0,t.mdx)("p",null,"While adaptive HMC can effectively tun the step size and covariance matrix, Bean Machine relies on a separate algorithm for tuning the path length ",(0,t.mdx)("span",{parentName:"p",className:"math math-inline"},(0,t.mdx)("span",{parentName:"span",className:"katex"},(0,t.mdx)("span",{parentName:"span",className:"katex-mathml"},(0,t.mdx)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,t.mdx)("semantics",{parentName:"math"},(0,t.mdx)("mrow",{parentName:"semantics"},(0,t.mdx)("mi",{parentName:"mrow"},"\u03bb")),(0,t.mdx)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"\\lambda")))),(0,t.mdx)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,t.mdx)("span",{parentName:"span",className:"base"},(0,t.mdx)("span",{parentName:"span",className:"strut",style:{height:"0.69444em",verticalAlign:"0em"}}),(0,t.mdx)("span",{parentName:"span",className:"mord mathnormal"},"\u03bb"))))),". This algorithm is called the No-U-Turn Sampler, and has its own documentation page, ",(0,t.mdx)("a",{parentName:"p",href:"/docs/no_u_turn_sampler"},"No-U-Turn Samplers"),"."),(0,t.mdx)("h2",{id:"usage"},"Usage"),(0,t.mdx)("p",null,"In Bean Machine, inference using HMC can be specified as an inference method for all variables in the model:"),(0,t.mdx)("pre",null,(0,t.mdx)("code",{parentName:"pre",className:"language-py"},"bm.SingleSiteHamiltonianMonteCarlo(\n    1.0,  # trajectory length\n    initial_step_size=0.1,\n    adapt_step_size=True\n    adapt_mass_matrix=True\n    target_accept_prob=0.8\n).infer(\n    queries,\n    observations,\n    num_samples,\n    num_chains,\n    num_adaptive_samples=100,\n)\n")),(0,t.mdx)("admonition",{type:"caution"},(0,t.mdx)("p",{parentName:"admonition"},(0,t.mdx)("strong",{parentName:"p"},"Make sure to set ",(0,t.mdx)("inlineCode",{parentName:"strong"},"num_adaptive_samples")," when using adaptive HMC!")," If you forget to set ",(0,t.mdx)("inlineCode",{parentName:"p"},"num_adaptive_samples"),", no adaptation will occur.")),(0,t.mdx)("p",null,"The global variant for adaptive HMC, ",(0,t.mdx)("inlineCode",{parentName:"p"},"GlobalHamiltonianMonteCarlo"),", which proposes all of the variables in the model jointly, follows the same API:"),(0,t.mdx)("pre",null,(0,t.mdx)("code",{parentName:"pre",className:"language-py"},"bm.GlobalHamiltonianMonteCarlo(\n    1.0,  # trajectory length\n    initial_step_size=0.1,\n    adapt_step_size=True,\n    adapt_mass_matrix=True,\n    target_accept_prob=0.8,\n    nnc_compile=True,\n).infer(\n    queries,\n    observations,\n    num_samples,\n    num_chains,\n    num_adaptive_samples=100,\n)\n")),(0,t.mdx)("admonition",{type:"caution"},(0,t.mdx)("p",{parentName:"admonition"},"Functorch's ",(0,t.mdx)("a",{parentName:"p",href:"https://pytorch.org/functorch/stable/aot_autograd.html"},"ahead of time (AOT) autograd compiler")," is used\nby default. If working with a non-static model or unexpected errors are encountered, you may need to manually\ndisable the ",(0,t.mdx)("inlineCode",{parentName:"p"},"nnc_compile")," flag.")),(0,t.mdx)("p",null,"These arguments allow us to decide if we want to tune the step size ",(0,t.mdx)("inlineCode",{parentName:"p"},"adjust_step_size")," or covariance matrix ",(0,t.mdx)("inlineCode",{parentName:"p"},"adapt_mass_matrix"),". The ",(0,t.mdx)("inlineCode",{parentName:"p"},"target_accept_prob")," argument indicates the acceptance probability which should be targeted by the step size tuning algorithm. While the optimal value is 65.1%, higher values have been show to be more robust. As a result, Bean Machine targets an acceptance rate of 0.8 by default."),(0,t.mdx)("p",null,"The parameters to ",(0,t.mdx)("inlineCode",{parentName:"p"},"infer")," are described below:"),(0,t.mdx)("table",null,(0,t.mdx)("thead",{parentName:"table"},(0,t.mdx)("tr",{parentName:"thead"},(0,t.mdx)("th",{parentName:"tr",align:null},"Name"),(0,t.mdx)("th",{parentName:"tr",align:null},"Usage"))),(0,t.mdx)("tbody",{parentName:"table"},(0,t.mdx)("tr",{parentName:"tbody"},(0,t.mdx)("td",{parentName:"tr",align:null},(0,t.mdx)("inlineCode",{parentName:"td"},"queries")),(0,t.mdx)("td",{parentName:"tr",align:null},"A ",(0,t.mdx)("inlineCode",{parentName:"td"},"List")," of ",(0,t.mdx)("inlineCode",{parentName:"td"},"@bm.random_variable")," targets to fit posterior distributions for.")),(0,t.mdx)("tr",{parentName:"tbody"},(0,t.mdx)("td",{parentName:"tr",align:null},(0,t.mdx)("inlineCode",{parentName:"td"},"observations")),(0,t.mdx)("td",{parentName:"tr",align:null},"The ",(0,t.mdx)("inlineCode",{parentName:"td"},"Dict")," of observations. Each key is a random variable, and its value is the observed value for that random variable.")),(0,t.mdx)("tr",{parentName:"tbody"},(0,t.mdx)("td",{parentName:"tr",align:null},(0,t.mdx)("inlineCode",{parentName:"td"},"num_samples")),(0,t.mdx)("td",{parentName:"tr",align:null},"Number of samples to build up distributions for the values listed in ",(0,t.mdx)("inlineCode",{parentName:"td"},"queries"),".")),(0,t.mdx)("tr",{parentName:"tbody"},(0,t.mdx)("td",{parentName:"tr",align:null},(0,t.mdx)("inlineCode",{parentName:"td"},"num_chains")),(0,t.mdx)("td",{parentName:"tr",align:null},"Number of separate inference runs to use. Multiple chains can be used by diagnostics to verify inference ran correctly.")),(0,t.mdx)("tr",{parentName:"tbody"},(0,t.mdx)("td",{parentName:"tr",align:null},(0,t.mdx)("inlineCode",{parentName:"td"},"num_adaptive_samples")),(0,t.mdx)("td",{parentName:"tr",align:null},"Number of warmup samples to adapt the parameters.")))),(0,t.mdx)("hr",null),(0,t.mdx)("p",null,'Neal, Radford M. "MCMC using Hamiltonian dynamics." ',(0,t.mdx)("em",{parentName:"p"},"Handbook of markov chain monte carlo")," 2.11 (2011): 2."),(0,t.mdx)("p",null,'Herbert Robbins. Sutton Monro. "A Stochastic Approximation Method." ',(0,t.mdx)("em",{parentName:"p"},"Ann. Math. Statist.")," 22 (3) 400 - 407, September, 1951. ",(0,t.mdx)("a",{parentName:"p",href:"https://doi.org/10.1214/aoms/1177729586"},"https://doi.org/10.1214/aoms/1177729586")))}x.isMDXComponent=!0}}]);